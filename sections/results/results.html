<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>OpenIVIS Summer 2024 Report – 5&nbsp; Results</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../sections/conclusion/index.html" rel="next">
<link href="../../sections/methods/index.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head><body class="nav-sidebar floating">\setcounter{page}{5}


<link rel="stylesheet" href="../../styles.css">




<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../sections/results/results.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Results</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">OpenIVIS Summer 2024 Report</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">OpenIVIS Summer 2024 Quarto Report</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/abstract/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Abstract</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/methods/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/results/results.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Results</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/conclusion/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/acknowledgements/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Acknowledgments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/appendix/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Appendix</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#system-verification-and-setup" id="toc-system-verification-and-setup" class="nav-link active" data-scroll-target="#system-verification-and-setup"><span class="header-section-number">5.1</span> System Verification and Setup</a>
  <ul>
  <li><a href="#changing-exposure-time" id="toc-changing-exposure-time" class="nav-link" data-scroll-target="#changing-exposure-time"><span class="header-section-number">5.1.1</span> Changing Exposure Time</a>
  <ul class="collapse">
  <li><a href="#read-and-plot-exposure-values" id="toc-read-and-plot-exposure-values" class="nav-link" data-scroll-target="#read-and-plot-exposure-values">Read and Plot Exposure Values</a></li>
  </ul></li>
  <li><a href="#changing-brightness-level" id="toc-changing-brightness-level" class="nav-link" data-scroll-target="#changing-brightness-level"><span class="header-section-number">5.1.2</span> Changing Brightness Level</a>
  <ul class="collapse">
  <li><a href="#read-and-plot-brightness-values" id="toc-read-and-plot-brightness-values" class="nav-link" data-scroll-target="#read-and-plot-brightness-values">Read and Plot Brightness Values</a></li>
  </ul></li>
  <li><a href="#measuring-from-a-photodiode" id="toc-measuring-from-a-photodiode" class="nav-link" data-scroll-target="#measuring-from-a-photodiode"><span class="header-section-number">5.1.3</span> Measuring From a Photodiode</a>
  <ul class="collapse">
  <li><a href="#read-and-plot-photodiode-values" id="toc-read-and-plot-photodiode-values" class="nav-link" data-scroll-target="#read-and-plot-photodiode-values">Read and Plot Photodiode Values</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#fluorescence-imaging" id="toc-fluorescence-imaging" class="nav-link" data-scroll-target="#fluorescence-imaging"><span class="header-section-number">5.2</span> Flourescence Imaging</a>
  <ul>
  <li><a href="#read-fitc-data-and-extract-values" id="toc-read-fitc-data-and-extract-values" class="nav-link" data-scroll-target="#read-fitc-data-and-extract-values">Read FITC Data and Extract Values</a></li>
  <li><a href="#plot-fitc-data" id="toc-plot-fitc-data" class="nav-link" data-scroll-target="#plot-fitc-data">Plot FITC Data</a></li>
  </ul></li>
  <li><a href="#laser-speckle-contrast-imaging" id="toc-laser-speckle-contrast-imaging" class="nav-link" data-scroll-target="#laser-speckle-contrast-imaging"><span class="header-section-number">5.3</span> Laser Speckle Contrast Imaging</a>
  <ul>
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation"><span class="header-section-number">5.3.1</span> Simulation</a>
  <ul class="collapse">
  <li><a href="#create-a-simulated-speckle-image" id="toc-create-a-simulated-speckle-image" class="nav-link" data-scroll-target="#create-a-simulated-speckle-image">Create a Simulated Speckle Image</a></li>
  <li><a href="#create-a-filter-and-apply-it-to-the-speckle-image-for-cutoff-frequency-n4-then-calculate-the-speckle-size" id="toc-create-a-filter-and-apply-it-to-the-speckle-image-for-cutoff-frequency-n4-then-calculate-the-speckle-size" class="nav-link" data-scroll-target="#create-a-filter-and-apply-it-to-the-speckle-image-for-cutoff-frequency-n4-then-calculate-the-speckle-size">Create a filter and apply it to the speckle image for cutoff frequency = N/4, then calculate the speckle size</a></li>
  <li><a href="#cutoff-frequency-n8" id="toc-cutoff-frequency-n8" class="nav-link" data-scroll-target="#cutoff-frequency-n8"><span class="header-section-number">5.3.1.1</span> Cutoff Frequency = N/8</a></li>
  <li><a href="#cutoff-frequency-n16" id="toc-cutoff-frequency-n16" class="nav-link" data-scroll-target="#cutoff-frequency-n16"><span class="header-section-number">5.3.1.2</span> Cutoff Frequency = N/16</a></li>
  </ul></li>
  <li><a href="#physical-tests" id="toc-physical-tests" class="nav-link" data-scroll-target="#physical-tests"><span class="header-section-number">5.3.2</span> Physical Tests</a>
  <ul class="collapse">
  <li><a href="#finding-the-moving-lsci-k-value-for-a-0.001s-exposure-time" id="toc-finding-the-moving-lsci-k-value-for-a-0.001s-exposure-time" class="nav-link" data-scroll-target="#finding-the-moving-lsci-k-value-for-a-0.001s-exposure-time">Finding the moving LSCI K value for a 0.001s exposure time</a></li>
  <li><a href="#finding-the-lsci-reproduction-of-different-flowrates-for-a-0.001s-exposure-time" id="toc-finding-the-lsci-reproduction-of-different-flowrates-for-a-0.001s-exposure-time" class="nav-link" data-scroll-target="#finding-the-lsci-reproduction-of-different-flowrates-for-a-0.001s-exposure-time">Finding the LSCI Reproduction of Different Flowrates for a 0.001s exposure time</a></li>
  <li><a href="#finding-the-moving-lsci-k-value-for-a-0.0008s-exposure-time" id="toc-finding-the-moving-lsci-k-value-for-a-0.0008s-exposure-time" class="nav-link" data-scroll-target="#finding-the-moving-lsci-k-value-for-a-0.0008s-exposure-time">Finding the moving LSCI K value for a 0.0008s exposure time</a></li>
  <li><a href="#finding-the-lsci-reproduction-of-different-flowrates-for-a-0.0008s-exposure-time" id="toc-finding-the-lsci-reproduction-of-different-flowrates-for-a-0.0008s-exposure-time" class="nav-link" data-scroll-target="#finding-the-lsci-reproduction-of-different-flowrates-for-a-0.0008s-exposure-time">Finding the LSCI Reproduction of Different Flowrates for a 0.0008s exposure time</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#additional-capabilities" id="toc-additional-capabilities" class="nav-link" data-scroll-target="#additional-capabilities"><span class="header-section-number">5.4</span> Additional Capabilities</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Results</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="system-verification-and-setup" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="system-verification-and-setup"><span class="header-section-number">5.1</span> System Verification and Setup</h2>
<section id="changing-exposure-time" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="changing-exposure-time"><span class="header-section-number">5.1.1</span> Changing Exposure Time</h3>
<p>In Fig. 5.1, there is a positive, non-linear relationship between exposure time and pixel intensity. Initially there is a large increase in pixel intensity as exposure time increases and this is most likely because as exposure time increases, more photons will be detected by the pixels in the camera. As exposure time continues to increase, the increase in pixel intensity starts to decrease. This is most likely because the pixels can only hold a certain amount of photons and when a pixel has stored its maximum amount of photons, it has reached its saturation point. As more photons are being detected by the pixels from the increasing exposure times, the pixels are getting closer to their saturation point <span class="citation" data-cites="hasinoff2021saturation"><a href="#ref-hasinoff2021saturation" role="doc-biblioref">[1]</a></span>. This plot also has a small error across the different trials, suggesting that the exposure times are precise.</p>
<section id="read-and-plot-exposure-values" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="read-and-plot-exposure-values">Read and Plot Exposure Values</h4>
<div id="6888526d" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show code from exposure_analysis.py</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> curve_fit</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> pd.read_excel(<span class="st">"Data/exposure/lastExposure1.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"Data/exposure/lastExposure2.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>data3 <span class="op">=</span> pd.read_excel(<span class="st">"Data/exposure/lastExposure3.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>data4 <span class="op">=</span> pd.read_excel(<span class="st">"Data/exposure/lastExposure4.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>data5 <span class="op">=</span> pd.read_excel(<span class="st">"Data/exposure/lastExposure5.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># For Exposure Times</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>data1_subsets <span class="op">=</span> [data1.iloc[i:i<span class="op">+</span><span class="dv">8</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">9</span>)]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>data2_subsets <span class="op">=</span> [data2.iloc[i:i<span class="op">+</span><span class="dv">8</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">9</span>)]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>data3_subsets <span class="op">=</span> [data3.iloc[i:i<span class="op">+</span><span class="dv">8</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">9</span>)]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>data4_subsets <span class="op">=</span> [data4.iloc[i:i<span class="op">+</span><span class="dv">8</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">9</span>)]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>data5_subsets <span class="op">=</span> [data5.iloc[i:i<span class="op">+</span><span class="dv">8</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">9</span>)]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means and std for each subset</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>m_data1 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data1_subsets])</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>m_data2 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data2_subsets])</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>m_data3 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data3_subsets])</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>m_data4 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data4_subsets])</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>m_data5 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data5_subsets])</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>s_data1 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data1_subsets])</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>s_data2 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data2_subsets])</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>s_data3 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data3_subsets])</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>s_data4 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data4_subsets])</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>s_data5 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data5_subsets])</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine means and std of each numbered data</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> np.mean([m_data1, m_data2, m_data3, m_data4, m_data5], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>stds <span class="op">=</span> np.std([s_data1, s_data2, s_data3, s_data4, s_data5], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>exp <span class="op">=</span> [<span class="fl">0.001</span>, <span class="fl">0.005</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>]</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>plt.errorbar(exp, means, yerr<span class="op">=</span>stds, fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, label<span class="op">=</span><span class="st">'Mean'</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Brightness Level = 0.7'</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Pixel Intensity vs. Exposure Time'</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">1100</span>])</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Exposure Time [s]'</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Pixel Intensity [a.u.]'</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Polynomial Fit</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>coeffs <span class="op">=</span> np.polyfit(exp, means, <span class="dv">4</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>y_fit <span class="op">=</span> np.polyval(coeffs, exp)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>plt.plot(exp, y_fit, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/exposure.png'</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/exposure.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: The pixel intensity versus exposure time.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="changing-brightness-level" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="changing-brightness-level"><span class="header-section-number">5.1.2</span> Changing Brightness Level</h3>
<p>In both of the plots shown in Fig. 5.2, there is a positive trend between brightness level and pixel intensity. When the exposure time was set to 0.01 seconds (Fig. 5.2a), the pixel intensity increases linearly and then flattens out around 1023 arbitrary units. This number matches with the intensity when exposure time is 0.01 seconds in Fig. 5.1 above, suggesting that the exposure time has a significant impact on the resulting plot of brightness level vs pixel intensity. When the exposure time is increased to 0.1 seconds in Fig. 5.2b, the linear portion of the graph seems to shift to higher brightness levels and starts to flatten out around 1000 arbitrary units. This intensity value also agrees with the intensity value of an exposure time of 0.1 seconds in Fig. 5.1 above. The trend that this data supports is that the camera will most accurately capture LED brightness when the brightness level is low and the exposure time is quick and when the brightness level is high and the exposure time is slow. There is also a very small error across the different trials, suggesting that the camera is capturing the LED brightness precisely.</p>
<section id="read-and-plot-brightness-values" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="read-and-plot-brightness-values">Read and Plot Brightness Values</h4>
<div id="3013e822" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code from brightness_analysis.py</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data from Sheet 2</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/lastBrightness1.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/lastBrightness2.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>data3 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/lastBrightness3.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>data4 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/lastBrightness4.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>data5 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/lastBrightness5.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># For Brightness Levels</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>data1_subsets <span class="op">=</span> [data1.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>data2_subsets <span class="op">=</span> [data2.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>data3_subsets <span class="op">=</span> [data3.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>data4_subsets <span class="op">=</span> [data4.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>data5_subsets <span class="op">=</span> [data5.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means and std for each subset</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>m_data1 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data1_subsets])</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>m_data2 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data2_subsets])</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>m_data3 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data3_subsets])</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>m_data4 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data4_subsets])</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>m_data5 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data5_subsets])</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>s_data1 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data1_subsets])</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>s_data2 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data2_subsets])</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>s_data3 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data3_subsets])</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>s_data4 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data4_subsets])</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>s_data5 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data5_subsets])</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine means and std of each numbered data</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> np.mean([m_data1, m_data2, m_data3, m_data4, m_data5], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>stds <span class="op">=</span> np.std([s_data1, s_data2, s_data3, s_data4, s_data5], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>bri <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>]</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>plt.errorbar(bri, means, yerr<span class="op">=</span>stds, fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'blue'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, label<span class="op">=</span><span class="st">'Mean'</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Exposure Time = 0.01 s'</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Pixel Intensity vs. Brightness Level'</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">1100</span>])</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Brightness Level [a.u.]'</span>)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Pixel Intensity [a.u.]'</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Polynomial Fit</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>coeffs <span class="op">=</span> np.polyfit(bri, means, <span class="dv">4</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>y_fit <span class="op">=</span> np.polyval(coeffs, bri)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>plt.plot(bri, y_fit, <span class="st">'b'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/brightness.png'</span>)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data from Sheet 2</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/B1.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/B2.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>data3 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/B3.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>data4 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/B4.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>data5 <span class="op">=</span> pd.read_excel(<span class="st">"Data/brightness/B5.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Sheet2"</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co"># For Brightness Levels</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>data1_subsets <span class="op">=</span> [data1.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>data2_subsets <span class="op">=</span> [data2.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>data3_subsets <span class="op">=</span> [data3.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>data4_subsets <span class="op">=</span> [data4.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>data5_subsets <span class="op">=</span> [data5.iloc[i:i<span class="op">+</span><span class="dv">9</span>].values.flatten() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">99</span>, <span class="dv">9</span>)]</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means and std for each subset</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>m_data1 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data1_subsets])</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>m_data2 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data2_subsets])</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>m_data3 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data3_subsets])</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>m_data4 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data4_subsets])</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>m_data5 <span class="op">=</span> np.array([np.mean(subset) <span class="cf">for</span> subset <span class="kw">in</span> data5_subsets])</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>s_data1 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data1_subsets])</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>s_data2 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data2_subsets])</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>s_data3 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data3_subsets])</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>s_data4 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data4_subsets])</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>s_data5 <span class="op">=</span> np.array([np.std(subset) <span class="cf">for</span> subset <span class="kw">in</span> data5_subsets])</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine means and std of each numbered data</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> np.mean([m_data1, m_data2, m_data3, m_data4, m_data5], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>stds <span class="op">=</span> np.std([s_data1, s_data2, s_data3, s_data4, s_data5], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>bri <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>]</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>plt.errorbar(bri, means, yerr<span class="op">=</span>stds, fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'blue'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, label<span class="op">=</span><span class="st">'Mean'</span>)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Exposure Time = 0.1 s'</span>)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Pixel Intensity vs. Brightness Level'</span>)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">1100</span>])</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Brightness Level [a.u.]'</span>)</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Pixel Intensity [a.u.]'</span>)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Polynomial Fit</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>coeffs <span class="op">=</span> np.polyfit(bri, means, <span class="dv">4</span>)</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>y_fit <span class="op">=</span> np.polyval(coeffs, bri)</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>plt.plot(bri, y_fit, <span class="st">'b'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/brightness2.png'</span>)</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/brightness.png" class="img-fluid figure-img"></p>
<figcaption>a. The pixel intensity versus brightness level for an exposure time of 0.01s.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/brightness2.png" class="img-fluid figure-img"></p>
<figcaption>b. The pixel intensity versus brightness level for an exposure time of 0.1.</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2
</figcaption>
</figure>
</div>
</section>
</section>
<section id="measuring-from-a-photodiode" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="measuring-from-a-photodiode"><span class="header-section-number">5.1.3</span> Measuring From a Photodiode</h3>
<p>Both Fig. 5.3a and Fig. 5.3b depict a positive, non-linear relationship between brightness and wattage from the photodiode. Fig. 5.3a shows increasing brightness level from the NeoPixel controls while Figure 5.3b shows increasing tuple value, or color code value. The plots are extremely similar in both shape and in error. The error across the different trials are a lot larger than in Figuress 5.1 and 5.2. This is because the photodiode is measuring the actual LED output rather than what the camera is capturing the brightness to be. The LEDs being used are off the shelf and relatively cheap, so it was expected that they would be less precise than more expensive LED options.</p>
<section id="read-and-plot-photodiode-values" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="read-and-plot-photodiode-values">Read and Plot Photodiode Values</h4>
<div id="9cec58e3" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show code from FITC_analysis.py</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>level <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>meanLevel <span class="op">=</span> [<span class="fl">0.566</span>, <span class="fl">194.9</span>, <span class="fl">373.5</span>, <span class="dv">552</span>, <span class="dv">687</span>, <span class="dv">820</span>, <span class="fl">964.3333333</span>, <span class="fl">1063.333333</span>, <span class="dv">1152</span>, <span class="dv">1222</span>, <span class="fl">1287.333333</span>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>stdLevel <span class="op">=</span> [<span class="fl">0.305</span>, <span class="fl">20.22374842</span>, <span class="fl">37.05738793</span>, <span class="fl">56.15158057</span>, <span class="fl">57.10516614</span>, <span class="fl">67.44627492</span>, <span class="fl">97.42860634</span>, <span class="fl">105.6519443</span>, <span class="fl">102.8931485</span>, <span class="fl">101.7693471</span>, <span class="fl">93.60199428</span>]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>tuple_vals <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">51</span>, <span class="dv">76</span>, <span class="dv">102</span>, <span class="dv">127</span>, <span class="dv">153</span>, <span class="dv">178</span>, <span class="dv">204</span>, <span class="dv">229</span>, <span class="dv">255</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>meanTuple <span class="op">=</span> [<span class="fl">0.566</span>, <span class="fl">194.7</span>, <span class="dv">384</span>, <span class="dv">552</span>, <span class="dv">710</span>, <span class="dv">843</span>, <span class="fl">961.3333333</span>, <span class="dv">1061</span>, <span class="fl">1148.333333</span>, <span class="dv">1221</span>, <span class="fl">1287.333333</span>]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>stdTuple <span class="op">=</span> [<span class="fl">0.305</span>, <span class="fl">19.43167517</span>, <span class="fl">38.19685851</span>, <span class="fl">53.3291665</span>, <span class="fl">67.29041537</span>, <span class="fl">76.92203845</span>, <span class="fl">83.912653</span>, <span class="fl">89.59910714</span>, <span class="fl">92.1430048</span>, <span class="fl">93.25770746</span>, <span class="fl">93.60199428</span>]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for tuple values</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>plt.errorbar(tuple_vals, meanTuple, yerr<span class="op">=</span>stdTuple, fmt<span class="op">=</span><span class="st">'ob'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Mean Tuple'</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Polynomial fit for tuple values</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>a1 <span class="op">=</span> np.polyfit(tuple_vals, meanTuple, <span class="dv">2</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> np.polyval(a1, tuple_vals)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>plt.plot(tuple_vals, y1, <span class="st">'b'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>pStr1 <span class="op">=</span> <span class="st">'y = </span><span class="sc">{:.2f}</span><span class="st">x^2 + </span><span class="sc">{:.2f}</span><span class="st">x + </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(a1[<span class="dv">0</span>], a1[<span class="dv">1</span>], a1[<span class="dv">2</span>])</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the residuals</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>residuals1 <span class="op">=</span> meanTuple <span class="op">-</span> y1</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the total sum of squares (SStot)</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>SStot1 <span class="op">=</span> np.<span class="bu">sum</span>((meanTuple <span class="op">-</span> np.mean(meanTuple))<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the sum of squares of residuals (SSres)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>SSres1 <span class="op">=</span> np.<span class="bu">sum</span>(residuals1<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate R-squared</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>R21 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (SSres1 <span class="op">/</span> SStot1)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>pStr1R <span class="op">=</span> <span class="ss">f'R² = </span><span class="sc">{</span>R21<span class="sc">:.4f}</span><span class="ss">'</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'LED Output vs. Tuple Value for Brightness Level = 1'</span>)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Tuple Value [a.u.]'</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'LED Output [nW]'</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">260</span>])</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">1400</span>])</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>xPos <span class="op">=</span> <span class="bu">max</span>(tuple_vals) <span class="op">-</span> <span class="dv">150</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>yPos <span class="op">=</span> <span class="bu">min</span>(meanTuple) <span class="op">+</span> <span class="dv">200</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>plt.text(xPos, yPos, pStr1, fontsize<span class="op">=</span><span class="dv">12</span>, color<span class="op">=</span><span class="st">'b'</span>)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>plt.text(xPos, yPos<span class="op">-</span><span class="dv">100</span>, pStr1, fontsize<span class="op">=</span><span class="dv">12</span>, color<span class="op">=</span><span class="st">'b'</span>)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/photodiodeTuple.png'</span>)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for brightness levels</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>plt.errorbar(level, meanLevel, yerr<span class="op">=</span>stdLevel, fmt<span class="op">=</span><span class="st">'+r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Mean Level'</span>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Polynomial fit for brightness levels</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>a2 <span class="op">=</span> np.polyfit(level, meanLevel, <span class="dv">2</span>)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> np.polyval(a2, level)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>plt.plot(level, y2, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>pStr2 <span class="op">=</span> <span class="st">'y = </span><span class="sc">{:.2f}</span><span class="st">x^2 + </span><span class="sc">{:.2f}</span><span class="st">x + </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(a2[<span class="dv">0</span>], a2[<span class="dv">1</span>], a2[<span class="dv">2</span>])</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the residuals</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>residuals2 <span class="op">=</span> meanLevel <span class="op">-</span> y2</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the total sum of squares (SStot)</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>SStot2 <span class="op">=</span> np.<span class="bu">sum</span>((meanLevel <span class="op">-</span> np.mean(meanLevel))<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the sum of squares of residuals (SSres)</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>SSres2 <span class="op">=</span> np.<span class="bu">sum</span>(residuals2<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate R-squared</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>R22 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (SSres2 <span class="op">/</span> SStot2)</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>pStr2R <span class="op">=</span> <span class="ss">f'R² = </span><span class="sc">{</span>R22<span class="sc">:.4f}</span><span class="ss">'</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'LED Output vs. Brightness Level for Brightness Tuple = (0,0,0,255)'</span>)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Brightness Level [a.u.]'</span>)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'LED Output [nW]'</span>)</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="fl">1.1</span>])</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">1400</span>])</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>xPos <span class="op">=</span> <span class="bu">max</span>(level) <span class="op">-</span> <span class="fl">0.6</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>yPos <span class="op">=</span> <span class="bu">min</span>(meanLevel) <span class="op">+</span> <span class="dv">200</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>plt.text(xPos, yPos, pStr2, fontsize<span class="op">=</span><span class="dv">12</span>, color<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>plt.text(xPos, yPos<span class="op">-</span><span class="dv">100</span>, pStr2, fontsize<span class="op">=</span><span class="dv">12</span>, color<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/photodiodeLevel.png'</span>)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/photodiodeTuple.png" class="img-fluid figure-img"></p>
<figcaption>a. The photodiode pixel intensity versus color code for a brightness level of 1.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/photodiodeLevel.png" class="img-fluid figure-img"></p>
<figcaption>b. The photodiode pixel intensity versus brightness level for a color code of (0,0,0,255).</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.3
</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="fluorescence-imaging" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="fluorescence-imaging"><span class="header-section-number">5.2</span> Flourescence Imaging</h2>
<p>Fig. 5.5 shows the normalized pixel intensities of all ten concentrations of FITC for eight different exposure times. As exposure time and concentration increases, the pixel intensity also increases. The 100 milliseconds, or 0.1 seconds, exposure time best represents the expected relationship between concentration and pixel intensity (green curve). As seen in Fig. 5.6, the lower concentrations of FITC are a lot less fluorescent than the higher concentrations. The green curve in Fig. 5.5 shows a large increase in pixel intensity in the higher concentrations, with it flattening out at the maximum value of 1 in the normalized plot. This maximum value of 1 corresponds to 1023 arbitrary units. The slower exposure times (purple and blue curves) also show the trend to an extent. These larger exposure times mean that the images captured by the camera are super bright, so most of the concentrations have large intensity values. The faster exposure times have the opposite effect. The images captured by the camera are super dark, and the pixel intensity values are low. The intensity values for each concentration represent how fluorescent each concentration is. Based on this data, the higher concentrations of FITC are more fluorescent than the lower concentrations.</p>
<section id="read-fitc-data-and-extract-values" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="read-fitc-data-and-extract-values">Read FITC Data and Extract Values</h4>
<div id="2393fee5" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code from FITC_analysis.py</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data from the Excel files</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> pd.read_excel(<span class="st">"Data/FITC/pixel_circle1.xlsx"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> pd.read_excel(<span class="st">"Data/FITC/pixel_circle2.xlsx"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>data3 <span class="op">=</span> pd.read_excel(<span class="st">"Data/FITC/pixel_circle3.xlsx"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>data4 <span class="op">=</span> pd.read_excel(<span class="st">"Data/FITC/pixel_circle4.xlsx"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>data5 <span class="op">=</span> pd.read_excel(<span class="st">"Data/FITC/pixel_circle5.xlsx"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>data1m <span class="op">=</span> data1.iloc[:, <span class="dv">2</span>].values</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>data2m <span class="op">=</span> data2.iloc[:, <span class="dv">2</span>].values</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>data3m <span class="op">=</span> data3.iloc[:, <span class="dv">2</span>].values</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>data4m <span class="op">=</span> data4.iloc[:, <span class="dv">2</span>].values</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>data5m <span class="op">=</span> data5.iloc[:, <span class="dv">2</span>].values</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>data1s <span class="op">=</span> data1.iloc[:, <span class="dv">3</span>].values</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>data2s <span class="op">=</span> data2.iloc[:, <span class="dv">3</span>].values</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>data3s <span class="op">=</span> data3.iloc[:, <span class="dv">3</span>].values</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>data4s <span class="op">=</span> data4.iloc[:, <span class="dv">3</span>].values</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>data5s <span class="op">=</span> data5.iloc[:, <span class="dv">3</span>].values</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the subsets For FITC</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>m_con_00001 <span class="op">=</span> np.array([data1m[:<span class="dv">10</span>], data2m[:<span class="dv">10</span>], data3m[:<span class="dv">10</span>], data4m[:<span class="dv">10</span>], data5m[:<span class="dv">10</span>]])</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>m_con_00005 <span class="op">=</span> np.array([data1m[<span class="dv">10</span>:<span class="dv">21</span>], data2m[<span class="dv">10</span>:<span class="dv">21</span>], data3m[<span class="dv">10</span>:<span class="dv">21</span>], data4m[<span class="dv">10</span>:<span class="dv">21</span>], data5m[<span class="dv">10</span>:<span class="dv">21</span>]])</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>m_con_00010 <span class="op">=</span> np.array([data1m[<span class="dv">21</span>:<span class="dv">32</span>], data2m[<span class="dv">21</span>:<span class="dv">32</span>], data3m[<span class="dv">21</span>:<span class="dv">32</span>], data4m[<span class="dv">21</span>:<span class="dv">32</span>], data5m[<span class="dv">21</span>:<span class="dv">32</span>]])</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>m_con_00050 <span class="op">=</span> np.array([data1m[<span class="dv">32</span>:<span class="dv">43</span>], data2m[<span class="dv">32</span>:<span class="dv">43</span>], data3m[<span class="dv">32</span>:<span class="dv">43</span>], data4m[<span class="dv">32</span>:<span class="dv">43</span>], data5m[<span class="dv">32</span>:<span class="dv">43</span>]])</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>m_con_00100 <span class="op">=</span> np.array([data1m[<span class="dv">43</span>:<span class="dv">54</span>], data2m[<span class="dv">43</span>:<span class="dv">54</span>], data3m[<span class="dv">43</span>:<span class="dv">54</span>], data4m[<span class="dv">43</span>:<span class="dv">54</span>], data5m[<span class="dv">43</span>:<span class="dv">54</span>]])</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>m_con_00500 <span class="op">=</span> np.array([data1m[<span class="dv">54</span>:<span class="dv">65</span>], data2m[<span class="dv">54</span>:<span class="dv">65</span>], data3m[<span class="dv">54</span>:<span class="dv">65</span>], data4m[<span class="dv">54</span>:<span class="dv">65</span>], data5m[<span class="dv">54</span>:<span class="dv">65</span>]])</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>m_con_01000 <span class="op">=</span> np.array([data1m[<span class="dv">65</span>:<span class="dv">76</span>], data2m[<span class="dv">65</span>:<span class="dv">76</span>], data3m[<span class="dv">65</span>:<span class="dv">76</span>], data4m[<span class="dv">65</span>:<span class="dv">76</span>], data5m[<span class="dv">65</span>:<span class="dv">76</span>]])</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>m_con_10000 <span class="op">=</span> np.array([data1m[<span class="dv">76</span>:<span class="dv">87</span>], data2m[<span class="dv">76</span>:<span class="dv">87</span>], data3m[<span class="dv">76</span>:<span class="dv">87</span>], data4m[<span class="dv">76</span>:<span class="dv">87</span>], data5m[<span class="dv">76</span>:<span class="dv">87</span>]])</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>m_con_05000 <span class="op">=</span> np.array([data1m[<span class="dv">87</span>:<span class="dv">98</span>], data2m[<span class="dv">87</span>:<span class="dv">98</span>], data3m[<span class="dv">87</span>:<span class="dv">98</span>], data4m[<span class="dv">87</span>:<span class="dv">98</span>], data5m[<span class="dv">87</span>:<span class="dv">98</span>]])</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>m_con_00001 <span class="op">=</span> m_con_00001.astype(<span class="bu">float</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>m_con_00005 <span class="op">=</span> m_con_00005.astype(<span class="bu">float</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>m_con_00010 <span class="op">=</span> m_con_00010.astype(<span class="bu">float</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>m_con_00050 <span class="op">=</span> m_con_00050.astype(<span class="bu">float</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>m_con_00100 <span class="op">=</span> m_con_00100.astype(<span class="bu">float</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>m_con_00500 <span class="op">=</span> m_con_00500.astype(<span class="bu">float</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>m_con_01000 <span class="op">=</span> m_con_01000.astype(<span class="bu">float</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>m_con_10000 <span class="op">=</span> m_con_10000.astype(<span class="bu">float</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>m_con_05000 <span class="op">=</span> m_con_05000.astype(<span class="bu">float</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate standard deviations</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>std_con_00001 <span class="op">=</span> np.std(m_con_00001, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>std_con_00005 <span class="op">=</span> np.std(m_con_00005, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>std_con_00010 <span class="op">=</span> np.std(m_con_00010, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>std_con_00050 <span class="op">=</span> np.std(m_con_00050, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>std_con_00100 <span class="op">=</span> np.std(m_con_00100, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>std_con_00500 <span class="op">=</span> np.std(m_con_00500, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>std_con_01000 <span class="op">=</span> np.std(m_con_01000, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>std_con_05000 <span class="op">=</span> np.std(m_con_05000, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>std_con_10000 <span class="op">=</span> np.std(m_con_10000, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>m_con_00001 <span class="op">=</span> np.mean(m_con_00001, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>m_con_00005 <span class="op">=</span> np.mean(m_con_00005, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>m_con_00010 <span class="op">=</span> np.mean(m_con_00010, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>m_con_00050 <span class="op">=</span> np.mean(m_con_00050, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>m_con_00100 <span class="op">=</span> np.mean(m_con_00100, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>m_con_00500 <span class="op">=</span> np.mean(m_con_00500, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>m_con_01000 <span class="op">=</span> np.mean(m_con_01000, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>m_con_05000 <span class="op">=</span> np.mean(m_con_05000, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>m_con_10000 <span class="op">=</span> np.mean(m_con_10000, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize data</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>std_con_00001 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>std_con_00005 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>std_con_00010 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>std_con_00050 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>std_con_00100 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>std_con_00500 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>std_con_01000 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>m_con_00001 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>m_con_00005 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>m_con_00010 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>m_con_00050 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>m_con_00100 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>m_con_00500 <span class="op">/=</span> <span class="dv">1023</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>m_con_01000 <span class="op">/=</span> <span class="dv">1023</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot-fitc-data" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="plot-fitc-data">Plot FITC Data</h4>
<div id="fd7c7823" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code from FITC_analysis.py</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>concentration <span class="op">=</span> [<span class="dv">10</span><span class="op">**-</span><span class="dv">3</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">4</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">5</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">6</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">7</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">8</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">9</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">11</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">12</span>, <span class="dv">10</span><span class="op">**-</span><span class="dv">14</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>conc <span class="op">=</span> [<span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">4</span>, <span class="op">-</span><span class="dv">5</span>, <span class="op">-</span><span class="dv">6</span>, <span class="op">-</span><span class="dv">7</span>, <span class="op">-</span><span class="dv">8</span>, <span class="op">-</span><span class="dv">9</span>, <span class="op">-</span><span class="dv">10</span>, <span class="op">-</span><span class="dv">11</span>, <span class="op">-</span><span class="dv">12</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>plt.plot(conc, m_con_00001[:<span class="dv">10</span>], <span class="st">'-o'</span>, color<span class="op">=</span><span class="st">'blue'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'1ms'</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>plt.plot(conc, m_con_00005[:<span class="dv">10</span>], <span class="st">'-o'</span>, color<span class="op">=</span><span class="st">'magenta'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'magenta'</span>, label<span class="op">=</span><span class="st">'5ms'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>plt.plot(conc, m_con_00010[:<span class="dv">10</span>], <span class="st">'-o'</span>, color<span class="op">=</span><span class="st">'#FFA500'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'#FFA500'</span>, label<span class="op">=</span><span class="st">'10ms'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>plt.plot(conc, m_con_00050[:<span class="dv">10</span>], <span class="st">'-o'</span>, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'50ms'</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>plt.plot(conc, m_con_00100[:<span class="dv">10</span>], <span class="st">'-o'</span>, color<span class="op">=</span><span class="st">'green'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="st">'100ms'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>plt.plot(conc, m_con_00500[:<span class="dv">10</span>], <span class="st">'-o'</span>, color<span class="op">=</span><span class="st">'cyan'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'cyan'</span>, label<span class="op">=</span><span class="st">'500ms'</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>plt.plot(conc, m_con_01000[:<span class="dv">10</span>], <span class="st">'-o'</span>, color<span class="op">=</span><span class="st">'#7E2F8E'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">6</span>, markerfacecolor<span class="op">=</span><span class="st">'#7E2F8E'</span>, label<span class="op">=</span><span class="st">'1000ms'</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>plt.errorbar(conc, m_con_00001[:<span class="dv">10</span>], yerr<span class="op">=</span>std_con_00001[:<span class="dv">10</span>], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'blue'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>plt.errorbar(conc, m_con_00005[:<span class="dv">10</span>], yerr<span class="op">=</span>std_con_00005[:<span class="dv">10</span>], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'magenta'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>plt.errorbar(conc, m_con_00010[:<span class="dv">10</span>], yerr<span class="op">=</span>std_con_00010[:<span class="dv">10</span>], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'#FFA500'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>plt.errorbar(conc, m_con_00050[:<span class="dv">10</span>], yerr<span class="op">=</span>std_con_00050[:<span class="dv">10</span>], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>plt.errorbar(conc, m_con_00100[:<span class="dv">10</span>], yerr<span class="op">=</span>std_con_00100[:<span class="dv">10</span>], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'green'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>plt.errorbar(conc, m_con_00500[:<span class="dv">10</span>], yerr<span class="op">=</span>std_con_00500[:<span class="dv">10</span>], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'cyan'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>plt.errorbar(conc, m_con_01000[:<span class="dv">10</span>], yerr<span class="op">=</span>std_con_01000[:<span class="dv">10</span>], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'#7E2F8E'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pixel Intensity vs. Concentration'</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Log[FITC Concentration M]'</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Pixel Intensity'</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/FITC.png'</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/FITC.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.4: TThe pixel intensity versus FITC concentration for varying exposure times.
</figcaption>
</figure>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/FITC2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.5: Fluorescent image of FITC concentrations in a well plate.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="laser-speckle-contrast-imaging" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="laser-speckle-contrast-imaging"><span class="header-section-number">5.3</span> Laser Speckle Contrast Imaging</h2>
<section id="simulation" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="simulation"><span class="header-section-number">5.3.1</span> Simulation</h3>
<p>Using the process described in Section 4.3.3, analysis on simulated speckle images and the effect of filtering was run. Fig. 5.7 depicts the simulated results for a filter with cutoff frequency of N/4, where N denotes the size of the speckle image in pixels, while Figures 5.8 and 5.9 show the results for cutoff frequency of N/8 and N/16, respectively.</p>
<section id="create-a-simulated-speckle-image" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="create-a-simulated-speckle-image">Create a Simulated Speckle Image</h4>
<div id="39a4a853" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code from speckleSimulation.py</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the necessary Python packages</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1 <span class="im">import</span> make_axes_locatable</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ft2(im):</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes the fourier transform</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.fftshift(np.fft.fft2(np.fft.ifftshift(im)))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Inverse Fourier Transform</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ift2(im):</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes the inverse fourier transform</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.ifftshift(np.fft.ifft2(np.fft.fftshift(im)))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a speckle pattern</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">200</span>  <span class="co"># Size of the speckle pattern</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.random.randn(N, N) <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> np.random.randn(N, N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="create-a-filter-and-apply-it-to-the-speckle-image-for-cutoff-frequency-n4-then-calculate-the-speckle-size" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="create-a-filter-and-apply-it-to-the-speckle-image-for-cutoff-frequency-n4-then-calculate-the-speckle-size">Create a filter and apply it to the speckle image for cutoff frequency = N/4, then calculate the speckle size</h4>
<div id="4c47432f" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show code from speckleSimulation.py</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute amplitude, phase and intensity of the original speckle pattern</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>amplitude <span class="op">=</span> np.<span class="bu">abs</span>(a)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>phase <span class="op">=</span> np.angle(a)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>intensity <span class="op">=</span> amplitude <span class="op">**</span><span class="dv">2</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourier transform of the speckle field</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> ft2(a)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a circular low-pass filter</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span>N<span class="op">/</span><span class="dv">2</span>, N<span class="op">/</span><span class="dv">2</span>, N)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span>N<span class="op">/</span><span class="dv">2</span>, N<span class="op">/</span><span class="dv">2</span>, N)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> np.meshgrid(x, y)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>radius <span class="op">=</span> np.sqrt(X<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> Y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>cutoff <span class="op">=</span> N<span class="op">/</span><span class="dv">4</span>  <span class="co"># Adjust the cutoff frequency to control the speckle size</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> radius <span class="op">&lt;</span> cutoff</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the low-pass filter</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>A_filtered <span class="op">=</span> A <span class="op">*</span> <span class="bu">filter</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse Fourier transform back to the spatial domain</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>a_filtered <span class="op">=</span> ift2(A_filtered)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the amplitude, phase and intensity of the filtered speckle pattern</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>amplitude_filtered <span class="op">=</span> np.<span class="bu">abs</span>(a_filtered)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>phase_filtered <span class="op">=</span> np.angle(a_filtered)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>intensity_filtered <span class="op">=</span> amplitude_filtered <span class="op">**</span><span class="dv">2</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation of the original and filtered speckle patterns</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">=</span> ift2(ft2(intensity) <span class="op">*</span> np.conj(ft2(intensity)))</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">=</span> ift2(ft2(intensity_filtered) <span class="op">*</span> np.conj(ft2(intensity_filtered)))</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">=</span> np.<span class="bu">abs</span>(autocorrelation_original)  <span class="co"># Take the magnitude</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">=</span> np.<span class="bu">abs</span>(autocorrelation_filtered)  <span class="co"># Take the magnitude</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the autocorrelations for better visualization</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">/=</span> autocorrelation_original.<span class="bu">max</span>()</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">/=</span> autocorrelation_filtered.<span class="bu">max</span>()</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co"># The code below is for finding the speckle sizes of the images</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the slice of the autocorrelation in line with the peak</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>central_slice_original <span class="op">=</span> autocorrelation_original[N<span class="op">//</span><span class="dv">2</span>, :]</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>central_slice_filtered <span class="op">=</span> autocorrelation_filtered[N<span class="op">//</span><span class="dv">2</span>, :]</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the halfway point between the maximum and the steady state</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>half_max_original <span class="op">=</span> ((central_slice_original.<span class="bu">max</span>() <span class="op">-</span> central_slice_original.<span class="bu">min</span>()) <span class="op">/</span> <span class="dv">2</span> ) <span class="op">+</span> central_slice_original.<span class="bu">min</span>()</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>half_max_filtered <span class="op">=</span> ((central_slice_filtered.<span class="bu">max</span>() <span class="op">-</span> central_slice_filtered.<span class="bu">min</span>()) <span class="op">/</span> <span class="dv">2</span> ) <span class="op">+</span> central_slice_filtered.<span class="bu">min</span>()</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all of the pixels above the halfway point</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>indices_original <span class="op">=</span> np.where(central_slice_original <span class="op">&gt;=</span> half_max_original)[<span class="dv">0</span>]</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>indices_filtered <span class="op">=</span> np.where(central_slice_filtered <span class="op">&gt;=</span> half_max_filtered)[<span class="dv">0</span>]</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the width of the peak at the halfway point</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> indices_original.size <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    speckle_size_original <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    speckle_size_original <span class="op">=</span> indices_original[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> indices_original[<span class="dv">0</span>]</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> indices_filtered.size <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    speckle_size_filtered <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    speckle_size_filtered <span class="op">=</span> indices_filtered[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> indices_filtered[<span class="dv">0</span>]</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Rayleigh Distribution for the amplitude histograms</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>flat <span class="op">=</span> np.<span class="bu">abs</span>(amplitude.flatten())</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>flat_fil <span class="op">=</span> np.<span class="bu">abs</span>(amplitude_filtered.flatten())</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> np.sqrt(np.mean(flat<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>sigma_fil <span class="op">=</span> np.sqrt(np.mean(flat_fil<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.<span class="bu">max</span>(flat), <span class="dv">255</span>)</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>x_fil <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.<span class="bu">max</span>(flat_fil), <span class="dv">255</span>)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>ray <span class="op">=</span> (x <span class="op">/</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> np.exp(<span class="op">-</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>ray_fil <span class="op">=</span> (x_fil <span class="op">/</span> sigma_fil<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> np.exp(<span class="op">-</span>x_fil<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma_fil<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom into the autocorrelations</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>zoom <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>center <span class="op">=</span> np.array(autocorrelation_original.shape) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>center_fil <span class="op">=</span> np.array(autocorrelation_filtered.shape) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>zoomRegion <span class="op">=</span> (<span class="bu">slice</span>(center[<span class="dv">0</span>]<span class="op">-</span>zoom, center[<span class="dv">0</span>]<span class="op">+</span>zoom), <span class="bu">slice</span>(center[<span class="dv">1</span>]<span class="op">-</span>zoom, center[<span class="dv">1</span>]<span class="op">+</span>zoom))</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>zoomRegion_fil <span class="op">=</span> (<span class="bu">slice</span>(center_fil[<span class="dv">0</span>]<span class="op">-</span>zoom, center_fil[<span class="dv">0</span>]<span class="op">+</span>zoom), <span class="bu">slice</span>(center_fil[<span class="dv">1</span>]<span class="op">-</span>zoom, center_fil[<span class="dv">1</span>]<span class="op">+</span>zoom))</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>autoZoom <span class="op">=</span> autocorrelation_original[zoomRegion]</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>autoZoom_fil <span class="op">=</span> autocorrelation_filtered[zoomRegion_fil]</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_colorbar(him, ax, cbar_title<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="co">    This function adds a nicely-formatted colorbar</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    divider <span class="op">=</span> make_axes_locatable(ax)</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>    cax <span class="op">=</span> divider.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> plt.colorbar(him, cax<span class="op">=</span>cax)</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(cbar_title, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Fiure fo comparing the autocorrelations of the original and filtered speckle patterns</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>fig, a <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the original amplitude</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>im_amp <span class="op">=</span> a[<span class="dv">0</span>, <span class="dv">0</span>].imshow(amplitude, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Original Speckle Field Amplitude'</span>)</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_amp, a[<span class="dv">0</span>, <span class="dv">0</span>], <span class="st">"Amplitude [a.u.]"</span>)</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the filtered amplitude</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>im_amp_filtered <span class="op">=</span> a[<span class="dv">0</span>, <span class="dv">1</span>].imshow(amplitude_filtered, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Filtered Speckle Field Amplitude'</span>)</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_amp_filtered, a[<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"Amplitude [a.u.]"</span>)</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the autocorrelation of the original speckle pattern</span></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>im_autoZoom <span class="op">=</span> a[<span class="dv">1</span>, <span class="dv">0</span>].imshow(autoZoom, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Autocorrelation of Original Speckle Pattern'</span>)</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_autoZoom, a[<span class="dv">1</span>, <span class="dv">0</span>], <span class="st">"Intensity [a.u.]"</span>)</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the autocorrelation of the filtered speckle pattern</span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>im_autoZoom_fil <span class="op">=</span> a[<span class="dv">1</span>, <span class="dv">1</span>].imshow(autoZoom_fil, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Autocorrelation of Filtered Speckle Pattern'</span>)</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_autoZoom_fil, a[<span class="dv">1</span>, <span class="dv">1</span>], <span class="st">"Intensity [a.u.]"</span>)</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the central slice of the original autocorrelation (zoomed)</span></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].plot(central_slice_original, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].axhline(y<span class="op">=</span>half_max_original, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Central Slice of Original Autocorrelation'</span>)</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'Pixel'</span>)</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].text(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="ss">f'Speckle size: </span><span class="sc">{</span>speckle_size_original<span class="sc">}</span><span class="ss"> pixels'</span>, color<span class="op">=</span><span class="st">'red'</span>, transform<span class="op">=</span>a[<span class="dv">2</span>,<span class="dv">0</span>].transAxes)</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the central slice of the filtered autocorrelation (zoomed)</span></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].plot(central_slice_filtered, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].axhline(y<span class="op">=</span>half_max_filtered, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_title(<span class="st">'Central Slice of Filtered Autocorrelation'</span>)</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'Pixel'</span>)</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].text(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="ss">f'Speckle size: </span><span class="sc">{</span>speckle_size_filtered<span class="sc">}</span><span class="ss"> pixels'</span>, color<span class="op">=</span><span class="st">'red'</span>, transform<span class="op">=</span>a[<span class="dv">2</span>,<span class="dv">1</span>].transAxes)</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/LSCISimulation.png'</span>)</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>plt.close(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/LSCISimulation.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.6: The simulated and filtered speckle images for cutoff frequency = N/4.
</figcaption>
</figure>
</div>
</section>
<section id="cutoff-frequency-n8" class="level4" data-number="5.3.1.1">
<h4 data-number="5.3.1.1" class="anchored" data-anchor-id="cutoff-frequency-n8"><span class="header-section-number">5.3.1.1</span> Cutoff Frequency = N/8</h4>
<div id="55570303" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show code from speckleSimulation.py</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the necessary Python packages</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1 <span class="im">import</span> make_axes_locatable</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ft2(im):</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes the fourier transform</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.fftshift(np.fft.fft2(np.fft.ifftshift(im)))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Inverse Fourier Transform</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ift2(im):</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes the inverse fourier transform</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.ifftshift(np.fft.ifft2(np.fft.fftshift(im)))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a speckle pattern</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">200</span>  <span class="co"># Size of the speckle pattern</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.random.randn(N, N) <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> np.random.randn(N, N)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute amplitude, phase and intensity of the original speckle pattern</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>amplitude <span class="op">=</span> np.<span class="bu">abs</span>(a)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>phase <span class="op">=</span> np.angle(a)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>intensity <span class="op">=</span> amplitude <span class="op">**</span><span class="dv">2</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourier transform of the speckle field</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> ft2(a)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a circular low-pass filter</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span>N<span class="op">/</span><span class="dv">2</span>, N<span class="op">/</span><span class="dv">2</span>, N)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span>N<span class="op">/</span><span class="dv">2</span>, N<span class="op">/</span><span class="dv">2</span>, N)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> np.meshgrid(x, y)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>radius <span class="op">=</span> np.sqrt(X<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> Y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>cutoff <span class="op">=</span> N<span class="op">/</span><span class="dv">8</span>  <span class="co"># Adjust the cutoff frequency to control the speckle size</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> radius <span class="op">&lt;</span> cutoff</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the low-pass filter</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>A_filtered <span class="op">=</span> A <span class="op">*</span> <span class="bu">filter</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse Fourier transform back to the spatial domain</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>a_filtered <span class="op">=</span> ift2(A_filtered)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the amplitude, phase and intensity of the filtered speckle pattern</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>amplitude_filtered <span class="op">=</span> np.<span class="bu">abs</span>(a_filtered)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>phase_filtered <span class="op">=</span> np.angle(a_filtered)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>intensity_filtered <span class="op">=</span> amplitude_filtered <span class="op">**</span><span class="dv">2</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation of the original and filtered speckle patterns</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">=</span> ift2(ft2(intensity) <span class="op">*</span> np.conj(ft2(intensity)))</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">=</span> ift2(ft2(intensity_filtered) <span class="op">*</span> np.conj(ft2(intensity_filtered)))</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">=</span> np.<span class="bu">abs</span>(autocorrelation_original)  <span class="co"># Take the magnitude</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">=</span> np.<span class="bu">abs</span>(autocorrelation_filtered)  <span class="co"># Take the magnitude</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the autocorrelations for better visualization</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">/=</span> autocorrelation_original.<span class="bu">max</span>()</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">/=</span> autocorrelation_filtered.<span class="bu">max</span>()</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co"># The code below is for finding the speckle sizes of the images</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the slice of the autocorrelation in line with the peak</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>central_slice_original <span class="op">=</span> autocorrelation_original[N<span class="op">//</span><span class="dv">2</span>, :]</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>central_slice_filtered <span class="op">=</span> autocorrelation_filtered[N<span class="op">//</span><span class="dv">2</span>, :]</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the halfway point between the maximum and the steady state</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>half_max_original <span class="op">=</span> ((central_slice_original.<span class="bu">max</span>() <span class="op">-</span> central_slice_original.<span class="bu">min</span>()) <span class="op">/</span> <span class="dv">2</span> ) <span class="op">+</span> central_slice_original.<span class="bu">min</span>()</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>half_max_filtered <span class="op">=</span> ((central_slice_filtered.<span class="bu">max</span>() <span class="op">-</span> central_slice_filtered.<span class="bu">min</span>()) <span class="op">/</span> <span class="dv">2</span> ) <span class="op">+</span> central_slice_filtered.<span class="bu">min</span>()</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all of the pixels above the halfway point</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>indices_original <span class="op">=</span> np.where(central_slice_original <span class="op">&gt;=</span> half_max_original)[<span class="dv">0</span>]</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>indices_filtered <span class="op">=</span> np.where(central_slice_filtered <span class="op">&gt;=</span> half_max_filtered)[<span class="dv">0</span>]</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the width of the peak at the halfway point</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> indices_original.size <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    speckle_size_original <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    speckle_size_original <span class="op">=</span> indices_original[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> indices_original[<span class="dv">0</span>]</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> indices_filtered.size <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    speckle_size_filtered <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    speckle_size_filtered <span class="op">=</span> indices_filtered[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> indices_filtered[<span class="dv">0</span>]</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Rayleigh Distribution for the amplitude histograms</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>flat <span class="op">=</span> np.<span class="bu">abs</span>(amplitude.flatten())</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>flat_fil <span class="op">=</span> np.<span class="bu">abs</span>(amplitude_filtered.flatten())</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> np.sqrt(np.mean(flat<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>sigma_fil <span class="op">=</span> np.sqrt(np.mean(flat_fil<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.<span class="bu">max</span>(flat), <span class="dv">255</span>)</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>x_fil <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.<span class="bu">max</span>(flat_fil), <span class="dv">255</span>)</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>ray <span class="op">=</span> (x <span class="op">/</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> np.exp(<span class="op">-</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>ray_fil <span class="op">=</span> (x_fil <span class="op">/</span> sigma_fil<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> np.exp(<span class="op">-</span>x_fil<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma_fil<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom into the autocorrelations</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>zoom <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>center <span class="op">=</span> np.array(autocorrelation_original.shape) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>center_fil <span class="op">=</span> np.array(autocorrelation_filtered.shape) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>zoomRegion <span class="op">=</span> (<span class="bu">slice</span>(center[<span class="dv">0</span>]<span class="op">-</span>zoom, center[<span class="dv">0</span>]<span class="op">+</span>zoom), <span class="bu">slice</span>(center[<span class="dv">1</span>]<span class="op">-</span>zoom, center[<span class="dv">1</span>]<span class="op">+</span>zoom))</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>zoomRegion_fil <span class="op">=</span> (<span class="bu">slice</span>(center_fil[<span class="dv">0</span>]<span class="op">-</span>zoom, center_fil[<span class="dv">0</span>]<span class="op">+</span>zoom), <span class="bu">slice</span>(center_fil[<span class="dv">1</span>]<span class="op">-</span>zoom, center_fil[<span class="dv">1</span>]<span class="op">+</span>zoom))</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>autoZoom <span class="op">=</span> autocorrelation_original[zoomRegion]</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>autoZoom_fil <span class="op">=</span> autocorrelation_filtered[zoomRegion_fil]</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_colorbar(him, ax, cbar_title<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a><span class="co">    This function adds a nicely-formatted colorbar</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>    divider <span class="op">=</span> make_axes_locatable(ax)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>    cax <span class="op">=</span> divider.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> plt.colorbar(him, cax<span class="op">=</span>cax)</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(cbar_title, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Fiure fo comparing the autocorrelations of the original and filtered speckle patterns</span></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>fig, a <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the original amplitude</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>im_amp <span class="op">=</span> a[<span class="dv">0</span>, <span class="dv">0</span>].imshow(amplitude, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Original Speckle Field Amplitude'</span>)</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_amp, a[<span class="dv">0</span>, <span class="dv">0</span>], <span class="st">"Amplitude [a.u.]"</span>)</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the filtered amplitude</span></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>im_amp_filtered <span class="op">=</span> a[<span class="dv">0</span>, <span class="dv">1</span>].imshow(amplitude_filtered, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Filtered Speckle Field Amplitude'</span>)</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_amp_filtered, a[<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"Amplitude [a.u.]"</span>)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the autocorrelation of the original speckle pattern</span></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>im_autoZoom <span class="op">=</span> a[<span class="dv">1</span>, <span class="dv">0</span>].imshow(autoZoom, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Autocorrelation of Original Speckle Pattern'</span>)</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_autoZoom, a[<span class="dv">1</span>, <span class="dv">0</span>], <span class="st">"Intensity [a.u.]"</span>)</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the autocorrelation of the filtered speckle pattern</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>im_autoZoom_fil <span class="op">=</span> a[<span class="dv">1</span>, <span class="dv">1</span>].imshow(autoZoom_fil, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Autocorrelation of Filtered Speckle Pattern'</span>)</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_autoZoom_fil, a[<span class="dv">1</span>, <span class="dv">1</span>], <span class="st">"Intensity [a.u.]"</span>)</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the central slice of the original autocorrelation (zoomed)</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].plot(central_slice_original, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].axhline(y<span class="op">=</span>half_max_original, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Central Slice of Original Autocorrelation'</span>)</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'Pixel'</span>)</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].text(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="ss">f'Speckle size: </span><span class="sc">{</span>speckle_size_original<span class="sc">}</span><span class="ss"> pixels'</span>, color<span class="op">=</span><span class="st">'red'</span>, transform<span class="op">=</span>a[<span class="dv">2</span>,<span class="dv">0</span>].transAxes)</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the central slice of the filtered autocorrelation (zoomed)</span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].plot(central_slice_filtered, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].axhline(y<span class="op">=</span>half_max_filtered, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_title(<span class="st">'Central Slice of Filtered Autocorrelation'</span>)</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'Pixel'</span>)</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].text(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="ss">f'Speckle size: </span><span class="sc">{</span>speckle_size_filtered<span class="sc">}</span><span class="ss"> pixels'</span>, color<span class="op">=</span><span class="st">'red'</span>, transform<span class="op">=</span>a[<span class="dv">2</span>,<span class="dv">1</span>].transAxes)</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/LSCISimulation2.png'</span>)</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>plt.close(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/LSCISimulation2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.7: The simulated and filtered speckle images for cutoff frequency = N/8.
</figcaption>
</figure>
</div>
</section>
<section id="cutoff-frequency-n16" class="level4" data-number="5.3.1.2">
<h4 data-number="5.3.1.2" class="anchored" data-anchor-id="cutoff-frequency-n16"><span class="header-section-number">5.3.1.2</span> Cutoff Frequency = N/16</h4>
<div id="84e3ec74" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show code from speckleSimulation.py</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the necessary Python packages</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1 <span class="im">import</span> make_axes_locatable</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ft2(im):</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes the fourier transform</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.fftshift(np.fft.fft2(np.fft.ifftshift(im)))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Inverse Fourier Transform</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ift2(im):</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes the inverse fourier transform</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.ifftshift(np.fft.ifft2(np.fft.fftshift(im)))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a speckle pattern</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">200</span>  <span class="co"># Size of the speckle pattern</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.random.randn(N, N) <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> np.random.randn(N, N)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute amplitude, phase and intensity of the original speckle pattern</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>amplitude <span class="op">=</span> np.<span class="bu">abs</span>(a)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>phase <span class="op">=</span> np.angle(a)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>intensity <span class="op">=</span> amplitude <span class="op">**</span><span class="dv">2</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourier transform of the speckle field</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> ft2(a)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a circular low-pass filter</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span>N<span class="op">/</span><span class="dv">2</span>, N<span class="op">/</span><span class="dv">2</span>, N)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span>N<span class="op">/</span><span class="dv">2</span>, N<span class="op">/</span><span class="dv">2</span>, N)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> np.meshgrid(x, y)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>radius <span class="op">=</span> np.sqrt(X<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> Y<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>cutoff <span class="op">=</span> N<span class="op">/</span><span class="dv">16</span>  <span class="co"># Adjust the cutoff frequency to control the speckle size</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> radius <span class="op">&lt;</span> cutoff</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the low-pass filter</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>A_filtered <span class="op">=</span> A <span class="op">*</span> <span class="bu">filter</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse Fourier transform back to the spatial domain</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>a_filtered <span class="op">=</span> ift2(A_filtered)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the amplitude, phase and intensity of the filtered speckle pattern</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>amplitude_filtered <span class="op">=</span> np.<span class="bu">abs</span>(a_filtered)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>phase_filtered <span class="op">=</span> np.angle(a_filtered)</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>intensity_filtered <span class="op">=</span> amplitude_filtered <span class="op">**</span><span class="dv">2</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation of the original and filtered speckle patterns</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">=</span> ift2(ft2(intensity) <span class="op">*</span> np.conj(ft2(intensity)))</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">=</span> ift2(ft2(intensity_filtered) <span class="op">*</span> np.conj(ft2(intensity_filtered)))</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">=</span> np.<span class="bu">abs</span>(autocorrelation_original)  <span class="co"># Take the magnitude</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">=</span> np.<span class="bu">abs</span>(autocorrelation_filtered)  <span class="co"># Take the magnitude</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the autocorrelations for better visualization</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>autocorrelation_original <span class="op">/=</span> autocorrelation_original.<span class="bu">max</span>()</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>autocorrelation_filtered <span class="op">/=</span> autocorrelation_filtered.<span class="bu">max</span>()</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co"># The code below is for finding the speckle sizes of the images</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the slice of the autocorrelation in line with the peak</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>central_slice_original <span class="op">=</span> autocorrelation_original[N<span class="op">//</span><span class="dv">2</span>, :]</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>central_slice_filtered <span class="op">=</span> autocorrelation_filtered[N<span class="op">//</span><span class="dv">2</span>, :]</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the halfway point between the maximum and the steady state</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>half_max_original <span class="op">=</span> ((central_slice_original.<span class="bu">max</span>() <span class="op">-</span> central_slice_original.<span class="bu">min</span>()) <span class="op">/</span> <span class="dv">2</span> ) <span class="op">+</span> central_slice_original.<span class="bu">min</span>()</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>half_max_filtered <span class="op">=</span> ((central_slice_filtered.<span class="bu">max</span>() <span class="op">-</span> central_slice_filtered.<span class="bu">min</span>()) <span class="op">/</span> <span class="dv">2</span> ) <span class="op">+</span> central_slice_filtered.<span class="bu">min</span>()</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all of the pixels above the halfway point</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>indices_original <span class="op">=</span> np.where(central_slice_original <span class="op">&gt;=</span> half_max_original)[<span class="dv">0</span>]</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>indices_filtered <span class="op">=</span> np.where(central_slice_filtered <span class="op">&gt;=</span> half_max_filtered)[<span class="dv">0</span>]</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the width of the peak at the halfway point</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> indices_original.size <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    speckle_size_original <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    speckle_size_original <span class="op">=</span> indices_original[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> indices_original[<span class="dv">0</span>]</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> indices_filtered.size <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    speckle_size_filtered <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    speckle_size_filtered <span class="op">=</span> indices_filtered[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> indices_filtered[<span class="dv">0</span>]</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Rayleigh Distribution for the amplitude histograms</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>flat <span class="op">=</span> np.<span class="bu">abs</span>(amplitude.flatten())</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>flat_fil <span class="op">=</span> np.<span class="bu">abs</span>(amplitude_filtered.flatten())</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> np.sqrt(np.mean(flat<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>sigma_fil <span class="op">=</span> np.sqrt(np.mean(flat_fil<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.<span class="bu">max</span>(flat), <span class="dv">255</span>)</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>x_fil <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.<span class="bu">max</span>(flat_fil), <span class="dv">255</span>)</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>ray <span class="op">=</span> (x <span class="op">/</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> np.exp(<span class="op">-</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>ray_fil <span class="op">=</span> (x_fil <span class="op">/</span> sigma_fil<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> np.exp(<span class="op">-</span>x_fil<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma_fil<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom into the autocorrelations</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>zoom <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>center <span class="op">=</span> np.array(autocorrelation_original.shape) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>center_fil <span class="op">=</span> np.array(autocorrelation_filtered.shape) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>zoomRegion <span class="op">=</span> (<span class="bu">slice</span>(center[<span class="dv">0</span>]<span class="op">-</span>zoom, center[<span class="dv">0</span>]<span class="op">+</span>zoom), <span class="bu">slice</span>(center[<span class="dv">1</span>]<span class="op">-</span>zoom, center[<span class="dv">1</span>]<span class="op">+</span>zoom))</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>zoomRegion_fil <span class="op">=</span> (<span class="bu">slice</span>(center_fil[<span class="dv">0</span>]<span class="op">-</span>zoom, center_fil[<span class="dv">0</span>]<span class="op">+</span>zoom), <span class="bu">slice</span>(center_fil[<span class="dv">1</span>]<span class="op">-</span>zoom, center_fil[<span class="dv">1</span>]<span class="op">+</span>zoom))</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>autoZoom <span class="op">=</span> autocorrelation_original[zoomRegion]</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>autoZoom_fil <span class="op">=</span> autocorrelation_filtered[zoomRegion_fil]</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_colorbar(him, ax, cbar_title<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="co">    This function adds a nicely-formatted colorbar</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>    divider <span class="op">=</span> make_axes_locatable(ax)</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>    cax <span class="op">=</span> divider.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> plt.colorbar(him, cax<span class="op">=</span>cax)</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(cbar_title, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Fiure fo comparing the autocorrelations of the original and filtered speckle patterns</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>fig, a <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the original amplitude</span></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>im_amp <span class="op">=</span> a[<span class="dv">0</span>, <span class="dv">0</span>].imshow(amplitude, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Original Speckle Field Amplitude'</span>)</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_amp, a[<span class="dv">0</span>, <span class="dv">0</span>], <span class="st">"Amplitude [a.u.]"</span>)</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the filtered amplitude</span></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>im_amp_filtered <span class="op">=</span> a[<span class="dv">0</span>, <span class="dv">1</span>].imshow(amplitude_filtered, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Filtered Speckle Field Amplitude'</span>)</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_amp_filtered, a[<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"Amplitude [a.u.]"</span>)</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the autocorrelation of the original speckle pattern</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>im_autoZoom <span class="op">=</span> a[<span class="dv">1</span>, <span class="dv">0</span>].imshow(autoZoom, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Autocorrelation of Original Speckle Pattern'</span>)</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_autoZoom, a[<span class="dv">1</span>, <span class="dv">0</span>], <span class="st">"Intensity [a.u.]"</span>)</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the autocorrelation of the filtered speckle pattern</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>im_autoZoom_fil <span class="op">=</span> a[<span class="dv">1</span>, <span class="dv">1</span>].imshow(autoZoom_fil, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Autocorrelation of Filtered Speckle Pattern'</span>)</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>add_colorbar(im_autoZoom_fil, a[<span class="dv">1</span>, <span class="dv">1</span>], <span class="st">"Intensity [a.u.]"</span>)</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the central slice of the original autocorrelation (zoomed)</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].plot(central_slice_original, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].axhline(y<span class="op">=</span>half_max_original, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">'Central Slice of Original Autocorrelation'</span>)</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'Pixel'</span>)</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">0</span>].text(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="ss">f'Speckle size: </span><span class="sc">{</span>speckle_size_original<span class="sc">}</span><span class="ss"> pixels'</span>, color<span class="op">=</span><span class="st">'red'</span>, transform<span class="op">=</span>a[<span class="dv">2</span>,<span class="dv">0</span>].transAxes)</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the central slice of the filtered autocorrelation (zoomed)</span></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].plot(central_slice_filtered, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].axhline(y<span class="op">=</span>half_max_filtered, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_title(<span class="st">'Central Slice of Filtered Autocorrelation'</span>)</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'Pixel'</span>)</span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">2</span>,<span class="dv">1</span>].text(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="ss">f'Speckle size: </span><span class="sc">{</span>speckle_size_filtered<span class="sc">}</span><span class="ss"> pixels'</span>, color<span class="op">=</span><span class="st">'red'</span>, transform<span class="op">=</span>a[<span class="dv">2</span>,<span class="dv">1</span>].transAxes)</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/LSCISimulation3.png'</span>)</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>plt.close(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/LSCISimulation3.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.8: The simulated and filtered speckle images for cutoff frequency= N/16.
</figcaption>
</figure>
</div>
<p>As the cutoff frequency decreases, the size of the speckle in pixels increases. The original speckle pattern has a speckle size of 1. A cutoff frequency of N/4 results in a filtered speckle size of 2 pixels, N/8 results in a filtered speckle size of 4 pixels, and N/16 results in a filtered speckle size of 8 pixels, as shown in Figures 5.7, 5.8, and 5.9. This implies that the filter size directly affects the resulting speckle size and a more narrow filter will produce a lower resolution image, but may decrease the noise in the speckle pattern. Additionally, as the filter’s cutoff frequency decreases, the amplitude histogram of the filtered patterns intensity decreases. Fig. 5.7 shows a normalized amplitude peak at approximately 1 for a cutoff frequency of N/4, while Fig. 5.9 shows an amplitude peak at 0.1 for a cutoff frequency of N/16. The simulated results also show an increase in autocorrelation with a decrease in cutoff frequency. The change in autocorrelation is indicative of the change in speckle size across the simulations. In real-world applications, an increase in autocorrelation across images may also imply differences in the subject’s roughness or uniformity.</p>
</section>
</section>
<section id="physical-tests" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="physical-tests"><span class="header-section-number">5.3.2</span> Physical Tests</h3>
<p>The LSCI analysis script was run on images with a cream and water mixture running through the tube at flow rates of 0 ml/hr, 50 ml/hr, 100 ml/hr, 150 ml/hr, and 200 ml/hr. The resulting speckle images, LSCI reproductions and LSCI K values are shown in Fig. 5.10 and Table 5.1. While there is a general decreasing trend in the K values as flow rate decreases, there are discrepancies from value to value.</p>
<section id="finding-the-moving-lsci-k-value-for-a-0.001s-exposure-time" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="finding-the-moving-lsci-k-value-for-a-0.001s-exposure-time">Finding the moving LSCI K value for a 0.001s exposure time</h4>
<div id="9c048da9" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show code from speckle_an.py</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1 <span class="im">import</span> make_axes_locatable</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> gaussian_filter</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load BMP image and convert to grayscale numpy array</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_and_normalize_image(image_path):</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(image_path).convert(<span class="st">'L'</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    img_array <span class="op">=</span> np.array(img)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize the image to range [0, 1]</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    img_normalized <span class="op">=</span> img_array <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> img_normalized</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Fourier Transform</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ft2(im):</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.fftshift(np.fft.fft2(np.fft.ifftshift(im)))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Inverse Fourier Transform</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ift2(im):</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.ifftshift(np.fft.ifft2(np.fft.fftshift(im)))</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate speckle contrast</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calcSpeckleContrast(image_path):</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> <span class="dv">2150</span><span class="op">;</span> x2 <span class="op">=</span> <span class="dv">2600</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> y2 <span class="op">=</span> <span class="dv">1600</span>  </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> plt.imread(image_path)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    intensity <span class="op">=</span> np.asarray(image[y1:y2, x1:x2])</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    photo <span class="op">=</span> gaussian_filter(intensity, <span class="dv">2</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> photo[:][:]</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    w_dev <span class="op">=</span> np.std(window)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    w_meanInt <span class="op">=</span> np.mean(window)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    w_speckle_contrast <span class="op">=</span> w_dev <span class="op">/</span> w_meanInt </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the selection of SQUARE x SQUARE pixels where speckle will be calculated</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    SQUARE <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert photo into an np array</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    pArr <span class="op">=</span> np.asarray(photo)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the speckle contrast array that will be returned</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    contrast_array <span class="op">=</span> [ [<span class="dv">0</span>]<span class="op">*</span>(<span class="bu">len</span>(pArr[<span class="dv">0</span>])<span class="op">-</span>SQUARE) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>((<span class="bu">len</span>(pArr))<span class="op">-</span>SQUARE) ]</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    conMin <span class="op">=</span> np.inf<span class="op">;</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The Loop Does the Following:</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># goes through 7x7 selections of the image</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># computes the speckle contrast for this region</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># using this comparison, create a new matrix with values whose magnitude</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># decreases depending on how "blurry" the selection is</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pArr) <span class="op">-</span> SQUARE):</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pArr[<span class="dv">0</span>]) <span class="op">-</span> SQUARE):</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>            x1 <span class="op">=</span> r<span class="op">;</span> x2 <span class="op">=</span> r<span class="op">+</span>SQUARE<span class="op">-</span><span class="dv">1</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>            y1 <span class="op">=</span> c<span class="op">;</span> y2 <span class="op">=</span> c<span class="op">+</span>SQUARE<span class="op">-</span><span class="dv">1</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>            selection <span class="op">=</span> pArr[x1:x2, y1:y2]</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>            s_dev <span class="op">=</span> np.std(selection)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>            s_meanInt <span class="op">=</span> np.mean(selection)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>            <span class="co"># to cut out values outside of the speckle caught on camera</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>            <span class="co">#if (s_meanInt &lt;= 0.1 and s_dev &lt;= 0.1):</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>              <span class="co"># contrast_array[r][c] = np.NaN</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>            <span class="co">#else:</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>            s_speckle_contrast <span class="op">=</span> s_dev <span class="op">/</span> s_meanInt</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s_speckle_contrast <span class="op">&lt;</span> conMin <span class="kw">and</span> s_speckle_contrast <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>                conMin <span class="op">=</span> s_speckle_contrast</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>            contrast_array[r][c] <span class="op">=</span> s_speckle_contrast</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    conArr <span class="op">=</span> np.asarray(contrast_array)</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    conArr[conArr <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> conMin</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (w_speckle_contrast, contrast_array)</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calcSpeckleContrastVal(image_path):</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> <span class="dv">2150</span><span class="op">;</span> x2 <span class="op">=</span> <span class="dv">2600</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> y2 <span class="op">=</span> <span class="dv">1600</span>  </span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> plt.imread(image_path)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>    intensity <span class="op">=</span> np.asarray(image[y1:y2, x1:x2])</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>    stat_x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> stat_x2 <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>    stat_y1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> stat_y2<span class="op">=</span> <span class="dv">50</span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    mov_x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> mov_x2 <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    mov_y1 <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> mov_y2 <span class="op">=</span> <span class="dv">250</span>      </span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> gaussian_filter(intensity, <span class="dv">2</span>)</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>    static_window <span class="op">=</span> np.asarray(filtered[stat_y1:stat_y2,stat_x1:stat_x2])</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>    stat_con <span class="op">=</span> np.std(static_window) <span class="op">/</span> np.mean(static_window)</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>    moving_window <span class="op">=</span> np.asarray(filtered[mov_y1:mov_y2,mov_x1:mov_x2])</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>    move_con <span class="op">=</span> np.std(moving_window) <span class="op">/</span> np.mean(moving_window)</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (move_con, stat_con)</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_images(folder_path):</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate through the folder and process images</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(folder_path):</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename.endswith(<span class="st">'.bmp'</span>):</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract flowrate and exposure time from the filename</span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>            parts <span class="op">=</span> filename.split(<span class="st">'_'</span>)</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>            flowrate <span class="op">=</span> parts[<span class="dv">1</span>]  <span class="co"># Assuming flowrate is the first part</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>            exposure_time <span class="op">=</span> parts[<span class="dv">2</span>]  <span class="co"># Assuming exposure time is the second part</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Initialize the flowrate in results dictionary if not already</span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> flowrate <span class="kw">not</span> <span class="kw">in</span> results:</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>                results[flowrate] <span class="op">=</span> {}</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Initialize the exposure time in the flowrate dictionary if not already</span></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> exposure_time <span class="kw">not</span> <span class="kw">in</span> results[flowrate]:</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>                results[flowrate][exposure_time] <span class="op">=</span> []</span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the LSCI from the image</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>            move_con, stat_con <span class="op">=</span> calcSpeckleContrastVal(os.path.join(folder_path, filename))</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>            results[flowrate][exposure_time].append(move_con)</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average for each exposure time within each flowrate</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>    averages <span class="op">=</span> {}</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>    stds <span class="op">=</span> {}</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> flowrate, exposure_times <span class="kw">in</span> results.items():</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>        averages[flowrate] <span class="op">=</span> {}</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> exposure_time, values <span class="kw">in</span> exposure_times.items():</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>            averages[flowrate][exposure_time] <span class="op">=</span> np.mean(values)</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert results to DataFrame for saving</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame.from_dict({(flowrate, exposure_time): avg </span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>                                  <span class="cf">for</span> flowrate, exposure_times <span class="kw">in</span> averages.items() </span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>                                  <span class="cf">for</span> exposure_time, avg <span class="kw">in</span> exposure_times.items()},</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>                                 orient<span class="op">=</span><span class="st">'index'</span>, columns<span class="op">=</span>[<span class="st">'Average Value'</span>]).reset_index()</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the MultiIndex into separate columns</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">'Flowrate'</span>, <span class="st">'Exposure Time'</span>]] <span class="op">=</span> pd.DataFrame(df[<span class="st">'index'</span>].tolist(), index<span class="op">=</span>df.index)</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop the original index column</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>    df.drop(<span class="st">'index'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rearrange columns</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[<span class="st">'Flowrate'</span>, <span class="st">'Exposure Time'</span>, <span class="st">'Average Value'</span>]]</span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>    df.to_csv(folder_path <span class="op">+</span> <span class="st">'/averages.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN CODE</span></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>folder_path <span class="op">=</span> <span class="st">'Data/0.001s'</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>process_images(folder_path)</span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-planets</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Average K value for 0.001s Exposure Time</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the csv as a Markdown table</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pd.read_csv(<span class="st">'Data/0.001s/averages.csv'</span>)</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"##### Table 5.1: Average K Values for 0.001s Exposure Tim {.unnumbered}"</span>))</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>Markdown(tabulate(</span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>  table, </span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>  headers<span class="op">=</span>[<span class="st">"Flowrate [ml/hr]"</span>,<span class="st">"Exposure Time [s]"</span>, <span class="st">"Average K [a.u.]"</span>]</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="table-5.1-average-k-values-for-0.001s-exposure-tim" class="level5 unnumbered cell-output cell-output-display cell-output-markdown">
<h5 class="unnumbered anchored" data-anchor-id="table-5.1-average-k-values-for-0.001s-exposure-tim">Table 5.1: Average K Values for 0.001s Exposure Tim</h5>
</section>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="10">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Flowrate [ml/hr]</th>
<th style="text-align: right;">Exposure Time [s]</th>
<th style="text-align: right;">Average K [a.u.]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td style="text-align: left;">200ml</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.365206</td>
</tr>
<tr class="even">
<td>1</td>
<td style="text-align: left;">50ml</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.367474</td>
</tr>
<tr class="odd">
<td>2</td>
<td style="text-align: left;">100ml</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.332304</td>
</tr>
<tr class="even">
<td>3</td>
<td style="text-align: left;">0ml</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.365184</td>
</tr>
<tr class="odd">
<td>4</td>
<td style="text-align: left;">238ml</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.359352</td>
</tr>
<tr class="even">
<td>5</td>
<td style="text-align: left;">150ml</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.371385</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="finding-the-lsci-reproduction-of-different-flowrates-for-a-0.001s-exposure-time" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="finding-the-lsci-reproduction-of-different-flowrates-for-a-0.001s-exposure-time">Finding the LSCI Reproduction of Different Flowrates for a 0.001s exposure time</h4>
<div id="8e326700" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show code from speckle_an.py</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>image_path1 <span class="op">=</span> <span class="st">'Data/0.001s/LSCI_0ml_0.001_1.bmp'</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>image_path2 <span class="op">=</span> <span class="st">'Data/0.001s/LSCI_50ml_0.001_1.bmp'</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>image_path3 <span class="op">=</span> <span class="st">'Data/0.001s/LSCI_100ml_0.001_1.bmp'</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>image_path4 <span class="op">=</span> <span class="st">'Data/0.001s/LSCI_150ml_0.001_1.bmp'</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>image_path5 <span class="op">=</span> <span class="st">'Data/0.001s/LSCI_200ml_0.001_1.bmp'</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> <span class="dv">2150</span><span class="op">;</span> x2 <span class="op">=</span> <span class="dv">2600</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> y2 <span class="op">=</span> <span class="dv">1600</span>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Original Speckle Image</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>original <span class="op">=</span> Image.<span class="bu">open</span>(image_path4).convert(<span class="st">'L'</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>og_int <span class="op">=</span> np.asarray(original)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>og_int <span class="op">=</span> og_int[y1:y2, x1:x2]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the speckle contrast</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>(cont1, contrast_array1) <span class="op">=</span> calcSpeckleContrast(image_path1)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>(cont2, contrast_array2) <span class="op">=</span> calcSpeckleContrast(image_path2)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>(cont3, contrast_array3) <span class="op">=</span> calcSpeckleContrast(image_path3)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>(cont4, contrast_array4) <span class="op">=</span> calcSpeckleContrast(image_path4)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>(cont5, contrast_array5) <span class="op">=</span> calcSpeckleContrast(image_path5)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>im0 <span class="op">=</span> ax[<span class="dv">0</span>,<span class="dv">0</span>].imshow(og_int, cmap <span class="op">=</span> <span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"(a) Intensity of Laser Speckle for 150 ml/hr"</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>divider0 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>cax0 <span class="op">=</span> divider0.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>cbar0 <span class="op">=</span> fig.colorbar(im0, cax<span class="op">=</span>cax0)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>cbar0.set_label(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>im1 <span class="op">=</span> ax[<span class="dv">0</span>,<span class="dv">1</span>].imshow(contrast_array1, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'(b) Speckle Contrast of Laser Speckle for 0 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>divider1 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>cax1 <span class="op">=</span> divider1.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>cbar1 <span class="op">=</span> fig.colorbar(im1, cax<span class="op">=</span>cax1)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>cbar1.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> ax[<span class="dv">0</span>,<span class="dv">2</span>].imshow(contrast_array2, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">2</span>].set_title(<span class="ss">f'(c) Speckle Contrast of Laser Speckle for 50 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>divider2 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">0</span>, <span class="dv">2</span>])</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>cax2 <span class="op">=</span> divider2.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>cbar2 <span class="op">=</span> fig.colorbar(im2, cax<span class="op">=</span>cax2)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>cbar2.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>im3 <span class="op">=</span> ax[<span class="dv">1</span>,<span class="dv">0</span>].imshow(contrast_array3, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'(d) Speckle Contrast of Laser Speckle for 100 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>divider3 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>cax3 <span class="op">=</span> divider3.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>cbar3 <span class="op">=</span> fig.colorbar(im3, cax<span class="op">=</span>cax3)</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>cbar3.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>im4 <span class="op">=</span> ax[<span class="dv">1</span>,<span class="dv">1</span>].imshow(contrast_array4, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'(e) Speckle Contrast of Laser Speckle for 150 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>divider4 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>cax4 <span class="op">=</span> divider4.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>cbar4 <span class="op">=</span> fig.colorbar(im4, cax<span class="op">=</span>cax4)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>cbar4.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>im5 <span class="op">=</span> ax[<span class="dv">1</span>,<span class="dv">2</span>].imshow(contrast_array5, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">2</span>].set_title(<span class="ss">f'(f) Speckle Contrast of Laser Speckle for 200 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>divider5 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>cax5 <span class="op">=</span> divider5.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>cbar5 <span class="op">=</span> fig.colorbar(im5, cax<span class="op">=</span>cax5)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>cbar5.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/LSCIReal.png'</span>)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>plt.close(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/LSCIReal.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.9: The real-world results for LSCI on a 150 ml/hr fluid for an exposure time of 0.001s.
</figcaption>
</figure>
</div>
<p>One potential reason for this discrepancy is in the exposure time used to capture the speckle images. Fig. 5.11 and Table 5.2 show the same calculations run on an exposure time with a lower exposure time of 0.0008s instead of 0.001s. The resulting values and LSCI reproductions produce similiar issues, signifying that the error lies somewhere else in the experimental setup or analysis.</p>
</section>
<section id="finding-the-moving-lsci-k-value-for-a-0.0008s-exposure-time" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="finding-the-moving-lsci-k-value-for-a-0.0008s-exposure-time">Finding the moving LSCI K value for a 0.0008s exposure time</h4>
<div id="18604b1b" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show code from speckle_an.py</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1 <span class="im">import</span> make_axes_locatable</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> gaussian_filter</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load BMP image and convert to grayscale numpy array</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_and_normalize_image(image_path):</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(image_path).convert(<span class="st">'L'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    img_array <span class="op">=</span> np.array(img)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize the image to range [0, 1]</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    img_normalized <span class="op">=</span> img_array <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> img_normalized</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Fourier Transform</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ft2(im):</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.fftshift(np.fft.fft2(np.fft.ifftshift(im)))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for Inverse Fourier Transform</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ift2(im):</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.fft.ifftshift(np.fft.ifft2(np.fft.fftshift(im)))</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate speckle contrast</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calcSpeckleContrast(image_path):</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> <span class="dv">2150</span><span class="op">;</span> x2 <span class="op">=</span> <span class="dv">2600</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> y2 <span class="op">=</span> <span class="dv">1600</span>  </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> plt.imread(image_path)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    intensity <span class="op">=</span> np.asarray(image[y1:y2, x1:x2])</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    photo <span class="op">=</span> gaussian_filter(intensity, <span class="dv">2</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> photo[:][:]</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    w_dev <span class="op">=</span> np.std(window)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    w_meanInt <span class="op">=</span> np.mean(window)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    w_speckle_contrast <span class="op">=</span> w_dev <span class="op">/</span> w_meanInt </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the selection of SQUARE x SQUARE pixels where speckle will be calculated</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    SQUARE <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert photo into an np array</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    pArr <span class="op">=</span> np.asarray(photo)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the speckle contrast array that will be returned</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    contrast_array <span class="op">=</span> [ [<span class="dv">0</span>]<span class="op">*</span>(<span class="bu">len</span>(pArr[<span class="dv">0</span>])<span class="op">-</span>SQUARE) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>((<span class="bu">len</span>(pArr))<span class="op">-</span>SQUARE) ]</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    conMin <span class="op">=</span> np.inf<span class="op">;</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The Loop Does the Following:</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># goes through 7x7 selections of the image</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># computes the speckle contrast for this region</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># using this comparison, create a new matrix with values whose magnitude</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># decreases depending on how "blurry" the selection is</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pArr) <span class="op">-</span> SQUARE):</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pArr[<span class="dv">0</span>]) <span class="op">-</span> SQUARE):</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>            x1 <span class="op">=</span> r<span class="op">;</span> x2 <span class="op">=</span> r<span class="op">+</span>SQUARE<span class="op">-</span><span class="dv">1</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>            y1 <span class="op">=</span> c<span class="op">;</span> y2 <span class="op">=</span> c<span class="op">+</span>SQUARE<span class="op">-</span><span class="dv">1</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>            selection <span class="op">=</span> pArr[x1:x2, y1:y2]</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>            s_dev <span class="op">=</span> np.std(selection)</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>            s_meanInt <span class="op">=</span> np.mean(selection)</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>            <span class="co"># to cut out values outside of the speckle caught on camera</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>            <span class="co">#if (s_meanInt &lt;= 0.1 and s_dev &lt;= 0.1):</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>              <span class="co"># contrast_array[r][c] = np.NaN</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>            <span class="co">#else:</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>            s_speckle_contrast <span class="op">=</span> s_dev <span class="op">/</span> s_meanInt</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s_speckle_contrast <span class="op">&lt;</span> conMin <span class="kw">and</span> s_speckle_contrast <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>                conMin <span class="op">=</span> s_speckle_contrast</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>            contrast_array[r][c] <span class="op">=</span> s_speckle_contrast</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>    conArr <span class="op">=</span> np.asarray(contrast_array)</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>    conArr[conArr <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> conMin</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (w_speckle_contrast, contrast_array)</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calcSpeckleContrastVal(image_path):</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> <span class="dv">2150</span><span class="op">;</span> x2 <span class="op">=</span> <span class="dv">2600</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> y2 <span class="op">=</span> <span class="dv">1600</span>  </span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> plt.imread(image_path)</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>    intensity <span class="op">=</span> np.asarray(image[y1:y2, x1:x2])</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>    stat_x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> stat_x2 <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    stat_y1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> stat_y2<span class="op">=</span> <span class="dv">50</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>    mov_x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> mov_x2 <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>    mov_y1 <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> mov_y2 <span class="op">=</span> <span class="dv">250</span>      </span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> gaussian_filter(intensity, <span class="dv">2</span>)</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>    static_window <span class="op">=</span> np.asarray(filtered[stat_y1:stat_y2,stat_x1:stat_x2])</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>    stat_con <span class="op">=</span> np.std(static_window) <span class="op">/</span> np.mean(static_window)</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>    moving_window <span class="op">=</span> np.asarray(filtered[mov_y1:mov_y2,mov_x1:mov_x2])</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>    move_con <span class="op">=</span> np.std(moving_window) <span class="op">/</span> np.mean(moving_window)</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (move_con, stat_con)</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_images(folder_path):</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate through the folder and process images</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(folder_path):</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename.endswith(<span class="st">'.bmp'</span>):</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract flowrate and exposure time from the filename</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>            parts <span class="op">=</span> filename.split(<span class="st">'_'</span>)</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>            flowrate <span class="op">=</span> parts[<span class="dv">1</span>]  <span class="co"># Assuming flowrate is the first part</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>            exposure_time <span class="op">=</span> parts[<span class="dv">2</span>]  <span class="co"># Assuming exposure time is the second part</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Initialize the flowrate in results dictionary if not already</span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> flowrate <span class="kw">not</span> <span class="kw">in</span> results:</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>                results[flowrate] <span class="op">=</span> {}</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Initialize the exposure time in the flowrate dictionary if not already</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> exposure_time <span class="kw">not</span> <span class="kw">in</span> results[flowrate]:</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>                results[flowrate][exposure_time] <span class="op">=</span> []</span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the LSCI from the image</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>            move_con, stat_con <span class="op">=</span> calcSpeckleContrastVal(os.path.join(folder_path, filename))</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>            results[flowrate][exposure_time].append(move_con)</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average for each exposure time within each flowrate</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>    averages <span class="op">=</span> {}</span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>    stds <span class="op">=</span> {}</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> flowrate, exposure_times <span class="kw">in</span> results.items():</span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>        averages[flowrate] <span class="op">=</span> {}</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> exposure_time, values <span class="kw">in</span> exposure_times.items():</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>            averages[flowrate][exposure_time] <span class="op">=</span> np.mean(values)</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert results to DataFrame for saving</span></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame.from_dict({(flowrate, exposure_time): avg </span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>                                  <span class="cf">for</span> flowrate, exposure_times <span class="kw">in</span> averages.items() </span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>                                  <span class="cf">for</span> exposure_time, avg <span class="kw">in</span> exposure_times.items()},</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>                                 orient<span class="op">=</span><span class="st">'index'</span>, columns<span class="op">=</span>[<span class="st">'Average Value'</span>]).reset_index()</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the MultiIndex into separate columns</span></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">'Flowrate'</span>, <span class="st">'Exposure Time'</span>]] <span class="op">=</span> pd.DataFrame(df[<span class="st">'index'</span>].tolist(), index<span class="op">=</span>df.index)</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop the original index column</span></span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>    df.drop(<span class="st">'index'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rearrange columns</span></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[<span class="st">'Flowrate'</span>, <span class="st">'Exposure Time'</span>, <span class="st">'Average Value'</span>]]</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>    df.to_csv(folder_path <span class="op">+</span> <span class="st">'/averages.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN CODE</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a>folder_path <span class="op">=</span> <span class="st">'Data/0.0008s'</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>process_images(folder_path)</span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-planets</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Average K value for 0.0008s Exposure Time</span></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the csv as a Markdown table</span></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pd.read_csv(<span class="st">'Data/0.0008s/averages.csv'</span>)</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"##### Table 5.2: Average K Values for 0.0008s Exposure Tim {.unnumbered}"</span>))</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a>Markdown(tabulate(</span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>  table, </span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>  headers<span class="op">=</span>[<span class="st">"Flowrate [ml/hr]"</span>,<span class="st">"Exposure Time [s]"</span>, <span class="st">"Average K [a.u.]"</span>]</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="finding-the-lsci-reproduction-of-different-flowrates-for-a-0.0008s-exposure-time" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="finding-the-lsci-reproduction-of-different-flowrates-for-a-0.0008s-exposure-time">Finding the LSCI Reproduction of Different Flowrates for a 0.0008s exposure time</h4>
<div id="dbd53d9b" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show code from speckle_an.py</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>image_path1 <span class="op">=</span> <span class="st">'Data/0.0008s/LSCI_0ml_0.0008_1.bmp'</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>image_path2 <span class="op">=</span> <span class="st">'Data/0.0008s/LSCI_50ml_0.0008_1.bmp'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>image_path3 <span class="op">=</span> <span class="st">'Data/0.0008s/LSCI_100ml_0.0008_1.bmp'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>image_path4 <span class="op">=</span> <span class="st">'Data/0.0008s/LSCI_150ml_0.0008_1.bmp'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>image_path5 <span class="op">=</span> <span class="st">'Data/0.0008s/LSCI_200ml_0.0008_1.bmp'</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> <span class="dv">2150</span><span class="op">;</span> x2 <span class="op">=</span> <span class="dv">2600</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span> y2 <span class="op">=</span> <span class="dv">1600</span>  </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Original Speckle Image</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>original <span class="op">=</span> Image.<span class="bu">open</span>(image_path4).convert(<span class="st">'L'</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>og_int <span class="op">=</span> np.asarray(original)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>og_int <span class="op">=</span> og_int[y1:y2, x1:x2]</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the speckle contrast</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>(cont1, contrast_array1) <span class="op">=</span> calcSpeckleContrast(image_path1)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>(cont2, contrast_array2) <span class="op">=</span> calcSpeckleContrast(image_path2)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>(cont3, contrast_array3) <span class="op">=</span> calcSpeckleContrast(image_path3)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>(cont4, contrast_array4) <span class="op">=</span> calcSpeckleContrast(image_path4)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>(cont5, contrast_array5) <span class="op">=</span> calcSpeckleContrast(image_path5)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>im0 <span class="op">=</span> ax[<span class="dv">0</span>,<span class="dv">0</span>].imshow(og_int, cmap <span class="op">=</span> <span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"(a) Intensity of Laser Speckle for 150 ml/hr"</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>divider0 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>cax0 <span class="op">=</span> divider0.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>cbar0 <span class="op">=</span> fig.colorbar(im0, cax<span class="op">=</span>cax0)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>cbar0.set_label(<span class="st">'Intensity [a.u.]'</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>im1 <span class="op">=</span> ax[<span class="dv">0</span>,<span class="dv">1</span>].imshow(contrast_array1, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="ss">f'(b) Speckle Contrast of Laser Speckle for 0 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>divider1 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>cax1 <span class="op">=</span> divider1.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>cbar1 <span class="op">=</span> fig.colorbar(im1, cax<span class="op">=</span>cax1)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>cbar1.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> ax[<span class="dv">0</span>,<span class="dv">2</span>].imshow(contrast_array2, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">2</span>].set_title(<span class="ss">f'(c) Speckle Contrast of Laser Speckle for 50 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>divider2 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">0</span>, <span class="dv">2</span>])</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>cax2 <span class="op">=</span> divider2.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>cbar2 <span class="op">=</span> fig.colorbar(im2, cax<span class="op">=</span>cax2)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>cbar2.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>im3 <span class="op">=</span> ax[<span class="dv">1</span>,<span class="dv">0</span>].imshow(contrast_array3, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="ss">f'(d) Speckle Contrast of Laser Speckle for 100 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>divider3 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>cax3 <span class="op">=</span> divider3.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>cbar3 <span class="op">=</span> fig.colorbar(im3, cax<span class="op">=</span>cax3)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>cbar3.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>im4 <span class="op">=</span> ax[<span class="dv">1</span>,<span class="dv">1</span>].imshow(contrast_array4, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="ss">f'(e) Speckle Contrast of Laser Speckle for 150 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>divider4 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>cax4 <span class="op">=</span> divider4.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>cbar4 <span class="op">=</span> fig.colorbar(im4, cax<span class="op">=</span>cax4)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>cbar4.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>im5 <span class="op">=</span> ax[<span class="dv">1</span>,<span class="dv">2</span>].imshow(contrast_array5, cmap <span class="op">=</span> <span class="st">"jet"</span>)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">2</span>].set_title(<span class="ss">f'(f) Speckle Contrast of Laser Speckle for 200 ml/hr'</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>divider5 <span class="op">=</span> make_axes_locatable(ax[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>cax5 <span class="op">=</span> divider5.append_axes(<span class="st">"right"</span>, size<span class="op">=</span><span class="st">"5%"</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>cbar5 <span class="op">=</span> fig.colorbar(im5, cax<span class="op">=</span>cax5)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>cbar5.set_label(<span class="st">'Speckle Contrast K [a.u.]'</span>)</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'images/LSCIReal2.png'</span>)</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>plt.close(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/LSCIReal2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.10: The real-world results for LSCI on a 150 ml/hr fluid for a 0.0008s exposure time.
</figcaption>
</figure>
</div>
<p>Another source of error might be the camera used to take the speckle images. The Arducam IMX519 camera is able to take high quality images with regular lighting conditions, but it is possible that it does not have the resolution and sensitivity needed for LSCI. A possible replacement for the Arducam camera is a <a href="https://www.raspberrypi.com/products/raspberry-pi-high-quality-camera/">Raspberry Pi High Quality (HQ) camera</a> which could be implemented with the same code as the Arducam camera. This has the potential to reach more conclusive results. Alternatively, an Industrial camera designed for taking speckle images may prove more effective, but not as cost effective as a Raspberry Pi camera.</p>
<p>Lastly, better filtering or image processing may assist in more accurate LSCI computation. The python scripts used in this project implemented the scipy Python library’s gaussian filter to produce a filtered speckle image before calculating the LSCI. Gaussian filters are a widely used filter in image processing for smoothing and noise reduction. It uses a gaussian kernel to perform a weighted average of the neighboring pixels around a central pixel, where the standard deviation of the gaussian kernel signifies the level of smoothing. Altering the gaussian fit or using a spatial filter as discussed in Brier et. al’s paper <span class="citation" data-cites="matthias2013laser"><a href="#ref-matthias2013laser" role="doc-biblioref">[2]</a></span> may prove more effective for future LSCI applications in the OpenIVIS system. Additionally, the window in which the moving and static LSCI data is being taken from may be innacurate and require a different location.</p>
</section>
</section>
</section>
<section id="additional-capabilities" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="additional-capabilities"><span class="header-section-number">5.4</span> Additional Capabilities</h2>
<p>The system was successful in taking time lapse images over an extended period of time and could be used for a broad range of biological imaging applications. The time lapse of the Tobacco Hornworm growth resulted in 45 images over the span of 9 days, with 5 hours between each image. An example of one week’s worth of growth is shown in Fig. 5.11.</p>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/TV Remote.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.11: A week’s worth of growth from one hornworm.
</figcaption>
</figure>
</div>
<p>The OpenIVIS system was able to take images of lettuce leaf decomposition over a three day period. The response imaged on the 1st day is shown in Fig. 12a and the 3rd day in Fig. 12b. The 3rd day shows a significantly NDIA response when compared to the first day, indicating a change in fluorescence output from the lettuce leaf. While the difference in response was imaged, due to limited documentation on how to conduct this experiment, the experimental process and calculations used may be incorrect. An accurate depiction of this trial is shown in the system’s previous publication by Branning et. al <span class="citation" data-cites="lee2024detection"><a href="#ref-lee2024detection" role="doc-biblioref">[3]</a></span>.</p>
<div id="731e4bf9" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show code from anthComp.py</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_log_ratio_heatmap(log_ratio, save_path):</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" </span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to plot and save the color map of the Anthocyanin response.</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments:</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">        log_ratio: A numpy array of the Anthocyanin response</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">        save_path: A string with the desired file saving path</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: </span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">        N/A</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the log ratio color map</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    plt.imshow(log_ratio, cmap<span class="op">=</span><span class="st">'cool'</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>, vmin <span class="op">=</span> <span class="dv">0</span>, vmax <span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(label<span class="op">=</span><span class="st">'NDIA'</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">' Ratio Heat Map'</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the log ratio color map</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    plt.savefig(save_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_image(image_path):</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" </span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to load an image as a numpy array.</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments:</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">        image_path: A string with the file path for an image</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: </span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">        image: The image loaded as grayscale</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> image <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Could not load image from </span><span class="sc">{</span>image_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_anth(red_excitation, green_excitation):</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" </span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to compute the Anthocyanin response.</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments:</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="co">        red_excitation: The loaded image with red excitation light</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="co">        green_excitation: The loaded image with green excitation light</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: </span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co">        NDAI: Thenormalized difference Anthocyanin index</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the images as 64-bit numpy arrays</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> np.float64(red_excitation)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> np.float64(green_excitation)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    np.errstate(divide<span class="op">=</span><span class="st">'ignore'</span>, invalid<span class="op">=</span><span class="st">'ignore'</span>)                                     <span class="co"># Ignore the zero values in the arrays </span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    red[np.isnan(red)] <span class="op">=</span> <span class="fl">0.0</span>                                                           <span class="co"># Replace Nan's with zeroes </span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    green[np.isnan(green)] <span class="op">=</span> <span class="fl">0.0</span>                                                       <span class="co"># Replace Nan's with zeroes  </span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    rgadd <span class="op">=</span> np.add(red,green)                                                          <span class="co"># Add the red and green images together </span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    rgsub <span class="op">=</span> np.subtract(red,green)                                                     <span class="co"># Subtract the green channel from the red channel </span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    red[red <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-6</span>                                                               <span class="co"># Replace zeroes with 1e-6 </span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    green[green <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-6</span>                                                           <span class="co"># Replace zeroes with 1e-6 </span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    NDAI <span class="op">=</span> np.log(np.divide(rgadd, rgsub))                                                     <span class="co"># Calculate the NDAI value</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NDAI</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the red and green images for the 3rd day</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>image1_path1 <span class="op">=</span> <span class="st">'images/day3Red_Red_1.000_0.100_5.000.png'</span>               <span class="co"># Replace if necessary</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>image2_path1 <span class="op">=</span> <span class="st">'images/day3Green_Green_1.000_1.000_5.000.png'</span>         <span class="co"># Replace if necessary</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>red_excitation1 <span class="op">=</span> load_image(image1_path1)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>green_excitation1 <span class="op">=</span> load_image(image2_path1)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the red and green images for the 1st day</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>image1_path2 <span class="op">=</span> <span class="st">'images/CloseFilter4_Red_1.000_0.100_5.000.png'</span>     <span class="co"># Replace if necessary</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>image2_path2 <span class="op">=</span> <span class="st">'images/CloseFilter7_Green_1.000_1.000_5.000.png'</span>   <span class="co"># Replace if necessary</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>red_excitation2 <span class="op">=</span> cv2.imread(image1_path2)</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>green_excitation2 <span class="op">=</span> cv2.imread(image2_path2)</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the NDAI</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>day1 <span class="op">=</span> compute_anth(red_excitation2, green_excitation2)</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>day3 <span class="op">=</span> compute_anth(red_excitation1, green_excitation1)</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>heatmap_path1 <span class="op">=</span> <span class="st">'images/log_ratio_Day1.png'</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>heatmap_path2 <span class="op">=</span> <span class="st">'images/log_ratio_Day3.png'</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>plot_log_ratio_heatmap(day1, save_path<span class="op">=</span>heatmap_path1)</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>plot_log_ratio_heatmap(day3, save_path<span class="op">=</span>heatmap_path2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-test-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/log_ratio_Day1.png" class="img-fluid figure-img"></p>
<figcaption>a. The anthocyanin response for the 1st day.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/log_ratio_Day3.png" class="img-fluid figure-img"></p>
<figcaption>b. The anthocyanin response for the 3rd day.</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-test-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.12
</figcaption>
</figure>
</div>


<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-hasinoff2021saturation" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">S. W. Hasinoff, <span>“Saturation (imaging),”</span> in <em>Computer vision: A reference guide</em>, Springer, 2021, pp. 1107–1109.</div>
</div>
<div id="ref-matthias2013laser" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">E. Matthias <em>et al.</em>, <span>“Laser speckle contrast imaging: Theoretical and practical limitations,”</span> <em>Journal of Biomedical Optics</em>, vol. 18, no. 6, p. 066018, 2013, doi: <a href="https://doi.org/10.1117/1.JBO.18.6.066018">10.1117/1.JBO.18.6.066018</a>.</div>
</div>
<div id="ref-lee2024detection" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">J. H. Lee, M. H. Park, S. Y. Kim, D. H. Lim, S. J. Lee, and J. W. Choi, <span>“Detection of aflatoxin B1 in rice using fluorescent nanoparticles with a fast response time,”</span> <em>PLOS ONE</em>, vol. 19, no. 2, p. e0299875, 2024, doi: <a href="https://doi.org/10.1371/journal.pone.0299875">10.1371/journal.pone.0299875</a>.</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../sections/methods/index.html" class="pagination-link" aria-label="Methods">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../sections/conclusion/index.html" class="pagination-link" aria-label="Conclusion">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Conclusion</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>